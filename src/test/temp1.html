<!DOCTYPE html>
<html lang="UTF-8" ng-clock ng-app="costdetailApp" ng-controller="costdetailCtrl">

<head>
    <title>创建分组</title>
    <include file="Template/Public/yb_include" />
</head>
<style type="text/css">
    /* 公共样式  beigin  lxq-2019-1-28*/

    .w130 {
        width: 130px;
    }

    .bot10 {
        margin-bottom: 10px;
    }

    .nowrap {
        white-space: nowrap;
    }

    /* 公共样式  over  lxq-2019-1-28*/

    .aui_content {
        width: 500px;
        height: 400px;
        overflow: auto;
    }

    .aui_content img {
        width: 100%;
        height: auto;
    }

    .actTag {
        padding-right: 12px;
    }

    .icon-close {
        display: inline-block;
        -webkit-appearance: none;
        cursor: pointer;
        position: absolute;
        top: -6px;
        right: -6px;
        width: 18px;
        height: 18px;
        background: url(__PUBLIC__/images/closeTab.png) 50% 50% no-repeat;
    }

    .Height36 {
        height: 36px;
        line-height: 36px;
    }

    .del {
        cursor: pointer;
        color: red;
    }

    button.yes {
        border: 1px solid #61b73b;
        padding: 0.5em 1.5em;
        border-radius: 4px;
        background: #61b72b;
        color: #fff;
    }

    .sex span {
        display: inline-block;
        padding: 0.6em 1.5em;
        color: #fff;
        border-radius: 0.4em;
        border: 1px solid #999;
        color: #000;
        margin-right: 1em;
        cursor: pointer;
        background: #fff;
    }

    .sex span.cur {
        background: #61b72b;
        color: #fff;
        border: 1px solid #61b72b;
    }

    .fontcolor {
        font-size: 1.6em;
        height: 36px;
        line-height: 36px;
        color: #999;
    }

    .inputtext {
        width: 100%;
        height: 3em;
        line-height: 3em;
        border: 1px solid #999;
        text-align: center;
        border-radius: 4px;
        background: #fff;
    }

    .addbutton {
        background: #FFFFFF;
        border: 1px solid #61B72B;
        border-radius: 4px;
        padding: 0.5em 2em;
        color: #61b72b;
    }

    .pagelink a {
        display: inline-block;
        background: #FFFFFF;
        border: 1px solid #999999;
        border-radius: 4px;
        padding: 0.5em 6em;
        color: #4A4A4A;
        margin: 0 2em;
    }

    .pagelink a.cur {
        border: 1px solid #61b72b;
        background: #61b72b;
        color: #fff;
    }

    .divbj {
        /* background: #F7FFF2; */
        position: absolute;
        top: -20px;
        right: -30px;
        bottom: -20px;
        left: -30px;
        border-bottom: 1px solid #61b72b;
    }

    .circlebox {
        margin-right: 4em;
        cursor: pointer;
    }

    .Wcircle {
        display: inline-block;
        width: 12px;
        height: 12px;
        border: 1px solid #999;
        border-radius: 50%;
        margin-right: 1em;
        position: relative;
    }

    .Ncircle {
        display: inline-block;
        width: 6px;
        height: 6px;
        background: #61b72b;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        margin-top: -3px;
        left: 50%;
        margin-left: -3px;
        display: none;
    }

    .circlebox.cur .Wcircle {
        border: 1px solid #61b72b;
    }

    .circlebox.cur .Ncircle {
        display: block;
    }

    .circlebox.no.cur .Wcircle {
        border: 1px solid #61b72b;
    }

    .circlebox.no.cur .Ncircle {
        display: block;
    }

    .yesSave {
        border: 1px solid #61B72B;
        margin: 1em 0 1em 0;
    }

    .yesSave:first-child {
        margin: 1em 0 1em 0;
    }

    .addteam {
        height: 36px;
        background: #61b72b;
        border: 1px solid #61b72b;
        color: #fff;
        border-radius: 6px;
    }

    .operatebox {
        position: relative;
        padding: 16px 0;
    }

    .operatebox img {
        display: block;
        margin: 16px auto;
        cursor: pointer;
    }

    .line {
        display: block;
        width: 1px;
        height: 120px;
        position: absolute;
        top: 50%;
        margin-top: -60px;
        left: 0;
        border-left: 1px solid #D0D0D0;
    }

    .addTempletBox {
        display: none;
    }

    .buttonBox {
        padding: 2em 0;
    }

    .buttonBox button.cur {
        color: #fff;
        background: #61b72b;
        border: 1px solid #61b72b;
    }

    .buttonBox button {
        line-height: 2em;
        border: 1px solid #999;
        background: #fff;
        border-radius: 4px;
    }

    .addTemplet {
        border: 1px solid #61b73b;
        border-radius: 4px;
        background: #61b72b;
        color: #fff;
    }

    .TempletBox>div {
        display: none;
    }

    .TempletBox div.cur {
        display: block;
    }

    .TempletBox div input {
        line-height: 3em;
        border: 1px solid #999;
        padding-left: 0.3em;
        margin-right: 0.3em;
    }

    button.add {
        height: 36px;
        background: #61b72b;
        border: 1px solid #61b72b;
        color: #fff;
        border-radius: 6px;
        margin-top: 2em;
    }

    .jjgd>div.cur {
        display: block;
    }

    .inputnums {
        text-align: center;
        border: 1px solid #999;
        border-radius: 3px;
    }

    .sameStyle {
        background: #fff;
        padding: 1rem;
        border-radius: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0px 4px 10px 0px #bebebe;
    }

    .wTime {
        width: 99%;
        height: 3em;
        line-height: 3em;
        border: 1px solid #999;
        border-radius: 3px;
    }

    @media screen and (min-width:769px) {
        .routerHidden img {
            position: fixed;
            left: 50%;
            top: 50%;
            margin-top: -70px;
            margin-left: -70px;
            width: 140px;
            height: 140px;
        }
    }

    @media screen and (max-width:768px) {
        .routerHidden img {
            position: fixed;
            left: 50%;
            top: 50%;
            margin-top: -2.5rem;
            margin-left: -2.5rem;
            width: 5rem;
            height: 5rem;
        }
    }

    #act-success {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, .5);
        z-index: 99;
    }

    .successContent {
        position: fixed;
        top: 50%;
        left: 50%;
        margin-top: -235px;
        left: 50%;
        margin-left: -300px;
        width: 600px;
        min-height: 470px;
        background: #fff;
        border-radius: 15px;
        padding-bottom: 20px;
    }

    .margin0 {
        margin: 0;
    }

    .success-header {
        position: relative;
        background: #61b72b;
        color: #fff;
        border-radius: 10px 10px 0 0;
        min-height: 80px;
        max-height: auto;
    }

    .success-header p:first-child {
        margin: 0;
        width: 87%;
        padding: .8em 1.4em;
        font-size: 16px;
        text-overflow: -o-ellipsis-lastline;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        max-height: 64px;
        overflow: hidden;
    }

    .success-header p:last-child {
        padding: .2em 1.6em .8em;
    }

    #act-success .btns {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #act-success .btns button {
        width: 160px;
        height: 44px;
    }

    #act-success .btns button:first-child {
        background: rgba(255, 255, 255, 1);
        border: 1px solid #61b72b;
        border-radius: 27px;
        color: #61b72b;
    }

    #act-success .btns button:last-child {
        margin-left: 13px;
        background: linear-gradient(172deg, rgba(146, 234, 88, 1), rgba(100, 184, 44, 1));
        box-shadow: 0px 6px 8px 0px rgba(109, 194, 53, 0.23);
        border-radius: 27px;
        color: #fff;
        border: none;

    }

    .ewm {
        display: none;
    }

    #act-success .linkadress {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 60px;
        margin-bottom: 20px;
        position: relative;
    }

    #act-success .linkadress input {
        height: 40px;
        width: 60%;
        margin: 0 20px;
        border: 1px solid #999;
        border-radius: 4px;
    }

    #code {
        height: 180px;
        width: 200px;
        margin: 0 auto 20px;
    }

    #act-success .btncopy {
        background: #61b72b;
        color: #fff;
        border: 1px solid #61b72b;
        border-radius: 5px;
        width: 50px;
        height: 30px;
    }

    #act-success .close {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 35px;
    }

    #act-success .hint {
        font-size: 16px;
        color: #999;
    }

    .copyok {
        display: none;
        position: absolute;
        right: 43px;
        top: -8px;
        color: #999;
    }

    .justTime {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding-left: 0;
    }

    .justTime::after {
        content: '分钟';
        position: absolute;
        right: 2.0rem;
        top: 0.6rem;
        font-size: 1.3rem;
    }

    .successok {
        text-align: center;
        color: #61b72b;
        font-size: 25px;
        line-height: 80px;
    }

    .timebox {
        padding-left: 11.8rem;
    }

    .timebox>div>div {
        display: inline-block;
    }

    .mark-star {
        color: red;
    }

    .cancelBtn {
        border: 1px solid #61b73b;
        padding: 0.5em 1.5em;
        border-radius: 4px;
        background: #FFFFFF;
    }

    .seize {
        color: transparent;
    }

    #inputselect {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 20px;
        background: transparent;
        border-color: transparent;
        height: 3em;
        display: flex;
        align-content: center;
        justify-content: center;
        border: 1px solid#999;
        border-right: none;
        border-radius: 4px 0 0 4px;
        padding-left: 5px;
    }

    .selectinput {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background: url('https://webcdn.kaisaile.org/updowndef.png') no-repeat right;
        background-size: 16px;
    }
    .competitionhint{
        background: #fff;
        border:1px solid #e5e5e5;
        border-radius: 5px;
        position: absolute;
        right: 0;
        top: 0;
        left: 35px;
        width: 22rem;
        z-index: 1;
        padding: 20px;
        display: none;
        text-align: center;
    }
    .competitionhint h6{margin-top:0;}
    .competitionhint p{
        text-align: left;
        text-indent: 2em;
        white-space: normal;
    }
    .competitionhelp{
        width: 20px;
        cursor: pointer;
        margin-left: 10px;
        margin-top: -3px;
    }
    .helpexplainbox{
        color: #000;
        justify-content: center;
        line-height: 31px;
        width: 100px;
        height: 35px;
        border: 1px solid #000;
        border-radius: 5px;
        text-align: center;
        float: right;
        cursor: pointer;
        margin-right: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .helpexplain{
        width: 18px;
        margin-right: 4px;
        margin-top: -4px;
    }
</style>

<body>
    <!-- Main navbar -->
    <include file="Template/Public/yb_topbar" />
    <!-- /main navbar -->
    <!-- Page container -->
    <div class="page-container">
        <!-- Page content -->
        <div class="page-content">
            <!-- Main sidebar -->
            <include file="Template/Public/yb_sidebar" />
            <!-- /main sidebar -->
            <!-- Main content -->
            <div class="content-wrapper">
                <!-- Page header -->
                <div class="page-header page-header-default">
                    <div class="breadcrumb-line">
                        <ul class="breadcrumb">
                            <li>
                                <a href="activityList?token=dummy">
                                    <i class="icon-home2 position-left"></i>赛事活动</a>
                            </li>
                            <li class="active">发布赛事</li>
                        </ul>
                    </div>
                </div>
                <!-- /page header -->
                <!-- Content area -->
                <div class="content">
                    <div class="row">
                        <div class="col-md-12">
                            <div ng-repeat="group in costLists">
                                <div class=" panel-flat" ng-show="group.showdetail==1">
                                    <div>
                                        <div class="col-md-12 infodiv" style="margin-bottom: 4em;padding:0;">
                                            <div class="col-md-12" style="padding:0;">
                                                <div class="divbj"></div>
                                                <form class="form-horizontal">
                                                    <div class="sameStyle">
                                                        <h4>组别信息</h4>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">分组名称:</div>
                                                                    <div class="col-md-9">

                                                                        <div class="col-md-11" style="padding: 0px;">
                                                                            <input type="text" class="inputtext groupName noempty" placeholder="请输入分组名称" style="text-align: left;padding-left: 1em;"
                                                                                ng-model="group.ticketName">
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">编排方式:</div>
                                                                    <div class="col-md-9">
                                                                        <select class="inputtext noempty" style="width: 42%;" ng-options="x.id as x.name for x in comppairs" ng-model="group.ticketPair"
                                                                            ng-change="ChangePair(group)">
                                                                        </select>
                                                                        <span ng-if="group.show_loop_promp" style='white-space: nowrap;'>
                                                                            <input type="checkbox" ng-click="group.loop_auto_permit?(group.loop_auto_permit=0):(group.loop_auto_permit=1)" ng-checked="group.loop_auto_permit">允许人数超过6人时自动变为瑞士制编排</span>
                                                                        <span ng-if="group.show_auto_promp" style='white-space: nowrap;'>1~3人采用双循环，4~6人采用单循环，超过6人采用瑞士制</span>
                                                                    </div>

                                                                </div>
                                                            </div>

                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">首轮排序:</div>
                                                                    <div class="col-md-9" ng-if="hdinfo.ext_type == 1 || hdinfo.ext_type == 2">
                                                                        <div class="col-md-11" style="padding-top: 10px;padding-left: 0px;">
                                                                            <input type="radio" ng-checked="!group.pair_sort_name" ng-click="group.pair_sort_name=false">&nbsp;按团队内出赛选手等级分之和优先
                                                                            <input type="radio" ng-checked="group.pair_sort_name" ng-click="group.pair_sort_name=true" style="margin-left: 20px;">&nbsp;按团队名称优先
                                                                        </div>
                                                                        <span style='white-space: nowrap;'>首轮团队进入编排的序号排序规则</span>
                                                                    </div>
                                                                    <div class="col-md-9" ng-if="hdinfo.ext_type != 1 && hdinfo.ext_type != 2">
                                                                        <div class="col-md-11" style="padding-top: 10px;padding-left: 0px;">
                                                                            <input type="radio" ng-checked="!group.pair_sort_name" ng-click="group.pair_sort_name=false">&nbsp;按等级分优先
                                                                            <input type="radio" ng-checked="group.pair_sort_name" ng-click="group.pair_sort_name=true" style="margin-left: 20px;">&nbsp;按姓名优先
                                                                        </div>
                                                                        <span style='white-space: nowrap;'>首轮选手进入编排的序号排序规则</span>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">报名费:</div>
                                                                    <div class="col-md-9">
                                                                        <div class="col-md-11" style="padding: 0px;">
                                                                            <div ng-hide="group.ticketPair == 1">
                                                                                <input type="text" onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9.]+/,'');
                                                                                dotpos = this.value.indexOf('.');
                                                                                if(dotpos != -1){
                                                                                    dotagain = this.value.indexOf('.', dotpos + 1);
                                                                                    if(dotagain != -1){
                                                                                        this.value = this.value.substr(0, dotagain);
                                                                                    }
                                                                                    this.value = this.value.substr(0, dotpos + 3);
                                                                                }
                                                                            }).call(this)" onblur="this.v();" class="inputtext cost noempty"
                                                                                    placeholder="0" style="text-align: left;padding-left: 1em;"
                                                                                    min="0" max="30" ng-model="group.ticketPrice">
                                                                            </div>
                                                                            <div ng-show="group.ticketPair == 1">
                                                                                <select class="inputtext noempty" style="width: 42%;" ng-options="x.id as x.name for x in QPairPrice" ng-model="group.ticketPrice"
                                                                                        ng-change="ChangeQPairPrice(group)">
                                                                                </select>
                                                                            </div>
                                                                            <div class="col-md-6 control-label">
                                                                                <label class="col-md-5">自主退费</label>
                                                                                <img style="width:3rem;margin-left: 10px" ng-src="{{group.refundbysign != '1' ? 'https://scdn.kaisaile.org/image/png/btnopen.png' : 'https://scdn.kaisaile.org/image/png/btnoff.png'}}"
                                                                                     alt="" class="btnonoff" ng-click="group.refundbysign=!group.refundbysign"
                                                                                />
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-11" style="padding-top: 10px;padding-left: 0px;">
                                                                            <input type="radio" ng-checked="!group.charge_type" ng-click="group.charge_type=0">&nbsp;机构内收费
                                                                            <input type="radio" ng-checked="group.charge_type" ng-click="group.charge_type=1" style="margin-left: 20px;">&nbsp;老师手动添加免费
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row" ng-show="hdinfo.ext_type == 1 || hdinfo.ext_type == 2">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">领队总数:</div>
                                                                    <div class="col-md-9">

                                                                        <div class="col-md-11" style="padding: 0px;">
                                                                            <input type="text" class="inputtext groupName noempty" placeholder="请输入领队总数，不输入则为不限制" style="text-align: left;padding-left: 1em;"
                                                                                   ng-model="group.leader_limit" ng-keyup="group.leader_limit=CheckInt(group.leader_limit);">
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row" ng-show="hdinfo.ext_type == 1 || hdinfo.ext_type == 2">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">每队人数:</div>
                                                                    <div class="col-md-9">

                                                                        <div class="col-md-11" style="padding: 0px;">
                                                                            <input type="text" class="inputtext groupName noempty" placeholder="请输入报名人数" style="text-align: left;padding-left: 1em;"
                                                                                ng-model="group.ticketSignCount" ng-keyup="group.ticketSignCount=CheckInt(group.ticketSignCount);">
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row" ng-show="hdinfo.ext_type == 0">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">报名上限:</div>
                                                                    <div class="col-md-9">

                                                                        <div class="col-md-5" style="padding: 0px;" ng-show="group.ticketNum > 0">
                                                                            <input type="text" class="inputtext groupName noempty" placeholder="请输入报名人数" style="text-align: left;padding-left: 1em;"
                                                                                   ng-model="group.ticketNum" ng-keyup="group.ticketNum=CheckInt(group.ticketNum);">
                                                                        </div>
                                                                        <div class="col-md-5" style="padding: 10px;">
                                                                            <input type="checkbox" value="" ng-checked="group.ticketNum <= 0" ng-click="group.ticketNum > 0 ? group.ticketNum = 0 : group.ticketNum = 100" style="margin-right: 5px;">不限人数
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!--  <div class="row" ng-show="hdinfo.ext_type == 1">
                                                        <div class="col-xs-6">
                                                            <div class="form-group">
                                                                <div class="col-md-3 Height36">候补人数:</div>
                                                                <div class="col-md-9">

                                                                    <div class="col-md-11" style="padding: 0px;">
                                                                        <input type="text"
                                                                                class="inputtext groupName noempty"
                                                                                placeholder="请输入候补人数"
                                                                                style="text-align: left;padding-left: 1em;"
                                                                                ng-model="group.ticketSignWait"
                                                                                ng-keyup="group.ticketSignWait=CheckInt(group.ticketSignWait);"
                                                                                >
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>-->
                                                        <div class="row" ng-show="group.ticketPrice > 0 && (jgid == 1016 || isMatchDirector)">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">VIP免费参赛 :</div>
                                                                    <div class="col-md-9 Height36">
                                                                        <span>
                                                                        白银VIP
                                                                        <img style="width:3rem;" ng-src="{{group.vipflag != 1 && group.vipflag != 3 ? 'https://scdn.kaisaile.org/image/png/btnoff.png':'https://scdn.kaisaile.org/image/png/btnopen.png'}}"
                                                                            alt="" class="btnonoff" ng-click="clickVipFlag(group, 1)"
                                                                        />
                                                                        </span>
                                                                        <span style="margin-left: 10px">
                                                                        特惠VIP
                                                                        <img style="width:3rem;" ng-src="{{group.vipflag != 2 && group.vipflag != 3 ? 'https://scdn.kaisaile.org/image/png/btnoff.png':'https://scdn.kaisaile.org/image/png/btnopen.png'}}"
                                                                             alt="" class="btnonoff" ng-click="clickVipFlag(group, 2)"
                                                                        />
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">比赛时制:</div>
                                                                    <div class="col-md-9">

                                                                        <div class="col-md-5" style="padding: 0px;">
                                                                            <input type="number" class="inputtext firstInput noempty" min="1" max="60" ng-model="group.ticketTime">
                                                                        </div>
                                                                        <div class="col-md-1 text-center fontcolor">+</div>

                                                                        <div class="col-md-5" style="padding: 0px;">
                                                                            <input type="number" class="inputtext sceondInput noempty" min="0" max="60" ng-model="group.ticketAdd">

                                                                        </div>

                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">比赛类型:</div>
                                                                    <div class="col-md-9 Height36">
                                                                        <select class="inputtext noempty" style="width: 42%;" ng-options="x.id as x.name for x in comptypes" ng-model="group.ticketType">

                                                                        </select>

                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- 是否需要实名认证 -->
                                                    <div class="sameStyle">
                                                        <h4>报名条件</h4>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3" style="white-space: nowrap;">是否需要实名认证：</div>
                                                                    <div class="col-md-9">
                                                                        <span class="circlebox yess " ng-class="{'cur':group.ticketNeedauth==1}">
                                                                            <i class="Wcircle" ng-click="SetNeedAuth(group, true)">
                                                                                <i class="Ncircle"></i>
                                                                            </i>是</span>
                                                                        <span class="circlebox no" ng-class="{'cur':group.ticketNeedauth==0}" ng-click="SetNeedAuth(group, false)">
                                                                            <i class="Wcircle">
                                                                                <i class="Ncircle"></i>
                                                                            </i>否</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- 是否记录等级分： -->
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">是否记录等级分：</div>
                                                                    <div class="col-md-9 Height36">
                                                                        <span class="circlebox" ng-class="{'cur':group.ticketEloEffect==1}" ng-click="group.ticketEloEffect=1">
                                                                            <i class="Wcircle">
                                                                                <i class="Ncircle"></i>
                                                                            </i>是</span>
                                                                        <span class="circlebox" ng-class="{'cur':group.ticketEloEffect==0}" ng-click="group.ticketEloEffect=0">
                                                                            <i class="Wcircle">
                                                                                <i class="Ncircle"></i>
                                                                            </i>否</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row none">
                                                            <div class="col-md-9">
                                                                <div class="form-group">
                                                                    <label class="col-lg-2 col-md-1 control-label">性别限制: </label>

                                                                    <div class="col-lg-5 sex" style="padding: 0px;margin-left: 10px;">
                                                                        <span ng-class="{'cur':group.ticketLimitSex==1}" ng-click="group.ticketLimitSex=1">男</span>
                                                                        <span ng-class="{'cur':group.ticketLimitSex==2}" ng-click="group.ticketLimitSex=2">女</span>
                                                                        <span ng-class="{'cur':group.ticketLimitSex==-1}" ng-click="group.ticketLimitSex=-1">不限</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row none">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">等级分限制:</div>
                                                                    <div class="col-md-9">
                                                                        <div class="col-md-5" style="padding: 0px;position: relative;">
                                                                            <!-- <input value="{{group.ticketEloMin == -1?'不限':group.ticketEloMin}}" ng-change="ticketEloChange()" type="number" class="inputtext" min="1" max="60">oninput = " ng-change="ticketEloChange(group,value)" ng-bind="group.ticketEloMin" ng-init="group.ticketEloMin='不限'" value=value.replace(/[^\d]/g,'')" -->
                                                                            <input type="text" id="inputselect" ng-model="showEloMin" ng-change="ticketEloMinChange(group,showEloMin)" ng-init="group.ticketEloMin && group.ticketEloMin != -1 ? (showEloMin = group.ticketEloMin) : (showEloMin ='不限')"
                                                                            />
                                                                            <select ng-options="x.id as x.name for x in elos" ng-model="showEloMin" ng-change="ticketEloMinChange(group,showEloMin)"
                                                                                class="inputtext selectinput" style="clip: rect(auto auto auto 45px);
                                                                            position: absolute;"></select>


                                                                            <!-- <input type="text" ng-model="group.ticketEloMin"
                                                                            ng-bind="group.ticketEloMin" ng-init="group.ticketEloMin='不限'"
                                                                              id="inputselect" oninput = "value=value.replace(/[^\d]/g,'')"  autofocus=""/> -->
                                                                            <!-- <select ng-options="x.id as x.name for x in elos" ng-model="group.ticketEloMin" class="inputtext selectinput"
                                                                            position: absolute;"></select> -->




                                                                        </div>
                                                                        <div class="col-md-1 text-center fontcolor">~</div>
                                                                        <div class="col-md-5" style="padding: 0px;">
                                                                            <!-- <input type="number" class="inputtext" min="0" max="60"> -->

                                                                            <input type="text" id="inputselect" ng-model="showEloMax" ng-change="ticketEloMaxChange(group,showEloMax)" ng-init="group.ticketEloMax && group.ticketEloMax != -1 ? (showEloMax = group.ticketEloMax) : (showEloMax ='不限')"
                                                                            />
                                                                            <select ng-options="x.id as x.name for x in elos" ng-model="showEloMax" ng-change="ticketEloMaxChange(group,showEloMax)"
                                                                                class="inputtext selectinput" style="clip: rect(auto auto auto 45px);
                                                                            position: absolute;"></select>

                                                                            <!-- <input type="text" ng-model="group.ticketEloMax"  autofocus=""
                                                                            id="inputselect" oninput = "value=value.replace(/[^\d]/g,'')" ng-bind="group.ticketEloMax" ng-init="group.ticketEloMax='不限'"/> -->
                                                                            <!-- <select ng-options="x.id as x.name for x in elos" ng-model="group.ticketEloMax" class="inputtext selectinput" ></select> -->

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row none">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">年龄限制:</div>
                                                                    <div class="col-md-9">
                                                                        <div class="col-md-5" style="padding: 0px;">
                                                                            <label ng-bind="group.ticketAgeMin==-1?'不限':group.ticketAgeMin" class="inputtext noempty" ng-click="ChooseBirth(group)" style="cursor: pointer">
                                                                            </label>
                                                                        </div>
                                                                        <div class="col-md-1 text-center fontcolor">~</div>
                                                                        <div class="col-md-5" style="padding: 0px;">
                                                                            <label ng-bind="group.ticketAgeMax==-1?'不限':group.ticketAgeMax" class="inputtext noempty" ng-click="ChooseBirth(group)" style="cursor: pointer">
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row none">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">认证等级限制:</div>
                                                                    <div class="col-md-9">
                                                                        <div class="col-md-5" style="padding: 0px;">
                                                                            <select class="inputtext" id="selectL" ng-options="x.id as x.name for x in levelLists" ng-model="group.ticketLevelMin"></select>
                                                                        </div>
                                                                        <div class="col-md-1 text-center fontcolor">~</div>
                                                                        <div class="col-md-5" style="padding: 0px;">
                                                                            <select class="inputtext" id="selectR" ng-options="x.id as x.name for x in levelLists" ng-model="group.ticketLevelMax"></select>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- Main navbar -->
                                                    <!-- 奖励模板： -->
                                                    <div class="sameStyle" ng-if="showdistribution">
                                                        <h4>奖励模式</h4>
                                                        <div class="row" ng-hide="group.ticketPrice==0 || group.ticketPair == 1">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36">报名费分账占比:</div>
                                                                    <div class="col-md-9">
                                                                        <div class="col-md-2 text-center Height36">奖金</div>
                                                                        <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                            <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" ng-keyup="group.Percent_Winner=CheckInt(group.Percent_Winner);" ng-blur="CheckValidDivide(group, false)"
                                                                                class="inputtext" style="height: 34px;" ng-model="group.Percent_Winner">&nbsp;%
                                                                        </div>
                                                                        <div class="col-md-4 text-center Height36">开赛了平台</div>
                                                                        <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                            <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" class="platform inputtext" style="height: 34px;" ng-model="group.Percent_PlatForm" ng-keyup="group.Percent_PlatForm=CheckInt(group.Percent_PlatForm);"
                                                                                ng-blur="CheckValidDivide(group, false)" required="required">&nbsp;%
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36"></div>
                                                                    <div class="col-md-9">
                                                                        <div class="col-md-2 text-center Height36">主办方</div>
                                                                        <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                            <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" ng-keyup="group.Percent_Leader=CheckInt(group.Percent_Leader);" ng-blur="CheckValidDivide(group, false)"
                                                                                class="inputtext" style="height: 34px;" ng-model="group.Percent_Leader">&nbsp;%
                                                                        </div>
                                                                        <div class="col-md-4 text-center Height36">{{hdinfo.ext_catgory == 11 ? '协办方' : '参赛方'}}</div>
                                                                        <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                            <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" ng-keyup="group.Percent_Club=CheckInt(group.Percent_Club);" ng-blur="CheckValidDivide(group, false)" class="inputtext"
                                                                                style="height: 34px;" ng-model="group.Percent_Club">&nbsp;%
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36"></div>
                                                                    <div class="col-md-9">
                                                                        <div class="col-md-2 text-center Height36">推广方</div>
                                                                        <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                            <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" ng-keyup="group.Percent_Share=CheckInt(group.Percent_Share);" ng-blur="CheckValidDivide(group, false)"
                                                                                   class="inputtext" style="height: 34px;" ng-model="group.Percent_Share">&nbsp;%
                                                                        </div>
                                                                        <div class="col-md-4 text-center Height36">承办方</div>
                                                                        <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                            <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" ng-keyup="group.Percent_Organizer=CheckInt(group.Percent_Organizer);" ng-blur="CheckValidDivide(group, false)" class="inputtext"
                                                                                   style="height: 34px;" ng-model="group.Percent_Organizer">&nbsp;%
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <div class="col-md-3 Height36"></div>
                                                                    <div class="col-md-9">
                                                                        <div class="col-md-2 text-center Height36">场地方</div>
                                                                        <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                            <input ng-disabled="hdinfo.ext_catgory!=6" type="text" ng-keyup="group.Percent_Zone=CheckInt(group.Percent_Zone);" ng-blur="CheckValidDivide(group, false)"
                                                                                   class="inputtext" style="height: 34px;" ng-model="group.Percent_Zone">&nbsp;%
                                                                        </div>
                                                                 <!--       <div class="col-md-4 text-center Height36">承办方</div>
                                                                        <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                            <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" ng-keyup="group.Percent_Organizer=CheckInt(group.Percent_Organizer);" ng-blur="CheckValidDivide(group, false)" class="inputtext"
                                                                                   style="height: 34px;" ng-model="group.Percent_Organizer">&nbsp;%
                                                                        </div>-->

                                                                    </div>
                                                                </div>
                                                                <div class="form-group" ng-show="hdinfo.ext_catgory == 11">
                                                                    <div class="col-md-3 Height36"></div>
                                                                    <div class="col-md-9">
                                                                        <div class="col-md-2 text-center Height36">机构分账</div>
                                                                        <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                            <input  type="text" ng-keyup="group.Percent_Design_Club=CheckInt(group.Percent_Design_Club);" ng-blur="CheckValidDivide(group, false)"
                                                                                   class="inputtext" style="height: 34px;" ng-model="group.Percent_Design_Club">&nbsp;%
                                                                        </div>
                                                                        <div class="col-md-6" style="padding: 0px;;display: flex;line-height: 34px;" ng-click="ShowChooseSponsor(group.Design_Club_Info)">
                                                                            <a  class="form-control"  ng-bind="group.Design_Club_Info.name" ></a>
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row" ng-if="showdistribution">
                                                            <div class="row">
                                                                <div class="col-xs-6">
                                                                    <div class="form-group">
                                                                        <div class="col-md-3 Height36" style="padding-left:20px">
                                                                            是否发放奖金：
                                                                        </div>
                                                                        <div class="col-md-9 Height36">
                                                                            <span class="circlebox bffjj" ng-class="{'cur':group.ticketBonus>0}" >
                                                                                <span ng-click="SetDisplan(group)">
                                                                                    <i class="Wcircle">
                                                                                    <i class="Ncircle"></i>
                                                                                </i>是
                                                                                </span>
                                                                                <span ng-click="ClickBonus(group)" ng-show="group.ticketBonus>0">
                                                                                <input type="checkbox"  ng-checked="group.ticketBonus==2">&nbsp;&nbsp;奖金线下发放
                                                                                </span>
                                                                            </span>
                                                                            <span class="circlebox bffjj" ng-class="{'cur':group.ticketBonus==0}" ng-click="group.ticketBonus=0" >
                                                                                <i class="Wcircle">
                                                                                    <i class="Ncircle"></i>
                                                                                </i>否</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row" ng-show="group.ticketBonus > 0 && group.ticketPair!=1">
                                                                    <div class="col-xs-6">
                                                                        <div class="form-group">
                                                                            <div class="col-md-9 Height36">
                                                                                <select class="inputtext noempty" style="width: 40%;margin-left: -52%;" ng-options="x.title for x in distributeTempList"
                                                                                    ng-model="group.ticketDistribute" ng-click="InitChooseDisPlan(group)">
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row" ng-show="group.ticketPair==1 && group.ticketBonus>0">
                                                                <div class="row">
                                                                    <div class="col-xs-6" style="padding-left: 15%;">
                                                                        <div class="form-group">
                                                                            <div class="col-md-6 Height36" style="padding-left:20px; float: left; width:100px;">奖金模板：
                                                                            </div>
                                                                            <select ng-show="group.ticketPrice != 20 && group.ticketPrice != 10" class="noempty" style="float: left; width: 200px;" ng-options="x.title for x in QPLAN_DEFAULT" ng-model="group.ticketDistribute">
                                                                            </select>
                                                                            <select ng-show="group.ticketPrice == 20" class="noempty" style="float: left; width: 200px;" ng-options="x.title for x in QPLAN_DEFAULT20" ng-model="group.ticketDistribute">
                                                                            </select>
                                                                            <select ng-show="group.ticketPrice == 10" class="noempty" style="float: left; width: 200px;" ng-options="x.title for x in QPLAN_DEFAULT10" ng-model="group.ticketDistribute">
                                                                            </select>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <div style="display: none;" class="col-md-12 Height36">

                                                                            </div>
                                                                            <div ng-show="group.ticketPrice < 100 && group.ticketPrice != 20 && group.ticketPrice != 10">
                                                                                <p>1、各组积分最高者获“冠军奖”奖励50元，如最高分有两人及两人以上，则平分50元。</p>
                                                                                <p>2、最后一轮获胜者得“坚持奖”奖励10元，如最后一轮和棋，则平分10元。</p>
                                                                            </div>
                                                                            <div ng-show="group.ticketPrice == 100">
                                                                                <p>1、各组积分最高者获“冠军奖”奖励50元，如最高分有两人及两人以上，则平分200元。</p>
                                                                                <p>2、最后一轮获胜者得“坚持奖”奖励10元，如最后一轮和棋，则平分40元。</p>
                                                                            </div>
                                                                            <div ng-show="group.ticketPrice == 20">
                                                                                <p>1、各组积分最高者获“冠军奖”奖励40元，如最高分有两人及两人以上，则平分40元。</p>
                                                                                <p>2、最后一轮获胜者得“坚持奖”奖励6元，如最后一轮和棋，则平分6元。</p>
                                                                            </div>
                                                                            <div ng-show="group.ticketPrice == 10">
                                                                                <p>1、各组积分最高者获“冠军奖”奖励20元，如最高分有两人及两人以上，则平分20元。</p>
                                                                                <p>2、最后一轮获胜者得“坚持奖”奖励3元，如最后一轮和棋，则平分3元。</p>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row" ng-hide="group.ticketPrice==0 || group.ticketPair != 1">
                                                                <div class="col-xs-6">
                                                                    <div class="form-group">
                                                                        <div class="col-md-3 Height36">报名费分账占比:</div>
                                                                        <div class="col-md-9">
                                                                            <div class="col-md-2 text-center Height36">奖金</div>
                                                                            <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                                <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" ng-keyup="group.Percent_Winner=CheckInt(group.Percent_Winner);" ng-blur="CheckValidDivide(group, false)"
                                                                                    class="inputtext" style="height: 34px;" ng-disabled="true"
                                                                                    ng-model="group.Percent_Winner">&nbsp;%
                                                                            </div>
                                                                            <div class="col-md-4 text-center Height36">开赛了平台</div>
                                                                            <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                                <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" class="platform inputtext" style="height: 34px;" ng-model="group.Percent_PlatForm" ng-keyup="group.Percent_PlatForm=CheckInt(group.Percent_PlatForm);"
                                                                                    ng-blur="CheckValidDivide(group, false)" ng-disabled="true"
                                                                                    required="required">&nbsp;%
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <div class="col-md-3 Height36"></div>
                                                                        <div class="col-md-9">
                                                                            <div class="col-md-2 text-center Height36">主办方</div>
                                                                            <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                                <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" ng-keyup="group.Percent_Leader=CheckInt(group.Percent_Leader);" ng-blur="CheckValidDivide(group, false)"
                                                                                    class="inputtext" style="height: 34px;" ng-disabled="true" ng-model="group.Percent_Leader">&nbsp;%
                                                                            </div>
                                                                            <div class="col-md-4 text-center Height36">参赛方</div>
                                                                            <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                                <input ng-disabled="group.vipflag==2 || group.vipflag==3" type="text" ng-disabled="true" ng-keyup="group.Percent_Club=CheckInt(group.Percent_Club);" ng-blur="CheckValidDivide(group, false)" class="inputtext"
                                                                                    style="height: 34px;" ng-model="group.Percent_Club">&nbsp;%
                                                                            </div>
                                                                        </div>
                                                                        <div style="padding-left: 170px; color: #888; padding-top: 50px;">
                                                                            <p>特别说明：</p>
                                                                            <p>1、平台+主办方+参赛方的比例之和不得超过30%。</p>
                                                                            <p>2、为保证奖金严格按照Q赛的奖励形式发放， Q赛的奖金分成占比不能修改，在保证奖金的情况下剩余的报名费由主办方获得。</p>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group" ng-if="false">
                                                                        <div class="col-md-3 Height36"></div>
                                                                        <div class="col-md-9">
                                                                            <div class="col-md-2 text-center Height36">推广方</div>
                                                                            <div class="col-md-2" style="padding: 0px;display: flex;line-height: 34px;">
                                                                                <input  type="text" ng-disabled="true" ng-keyup="group.Percent_Share=CheckInt(group.Percent_Share);" ng-blur="CheckValidDivide(group, false)"
                                                                                       class="inputtext" style="height: 34px;" ng-model="group.Percent_Share">&nbsp;%
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6 jjgdbox" ng-show="group.ticketDistribute && group.ticketBonus>0 && group.ticketPair!=1">
                                                                <div class="form-group">
                                                                    <div class="col-md-12" style="margin-left: 25%;margin-bottom: 20px;">
                                                                        <input class="inputtext noempty" style="width: 32%;" type="text" placeholder="请输入模板名称" ng-model="group.tempname">
                                                                        <button ng-click="SavePlanTemp(group, false)" style="height: 38px;
                                                background-color: #61b72b;
                                                border-radius: 0.4em;
                                                color: #fff;border: 0;">保存模板
                                                                        </button>
                                                                        <button ng-click="SavePlanTemp(group, true)" style="height: 38px;
                                                background-color: #61b72b;
                                                border-radius: 0.4em;
                                                color: #fff;border: 0;">另存为模板
                                                                        </button>
                                                                        <button ng-show="group.ticketDistribute.createby > 0" style="height: 38px;
                                                    background-color: #61b72b;
                                                    border-radius: 0.4em;
                                                    color: #fff;border: 0;" ng-click="DelPlanTemp(group)">删除模板
                                                                        </button>
                                                                    </div>
                                                                    <div>
                                                                        <div class="col-md-3 Height36">模板设置形式：
                                                                        </div>
                                                                        <div class="col-md-9 Height36">
                                                                            <span class="circlebox " ng-click="group.showfixplan=false" ng-class="{'cur':!group.showfixplan}">
                                                                                <i class="Wcircle">
                                                                                    <i class="Ncircle"></i>
                                                                                </i>奖金池形式</span>
                                                                            <span class="circlebox" ng-click="group.showfixplan=true" ng-class="{'cur':group.showfixplan}">
                                                                                <i class="Wcircle">
                                                                                    <i class="Ncircle"></i>
                                                                                </i>固定奖金形式</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <!-- 奖金池模板 -->
                                                                    <div class="row cur" ng-hide="group.showfixplan">
                                                                        <div class="col-md-12">
                                                                            <ul class="list1">
                                                                                <li class="list_head" style=" list-style:none;display:flex;position: relative;width: 100%;">
                                                                                    <div class="bonus col-md-4">
                                                                                        <p>奖励类型</p>
                                                                                    </div>
                                                                                    <div class="bonus col-md-4">
                                                                                        <p>奖励等级</p>
                                                                                    </div>
                                                                                    <div class="bonusRatio col-md-4">
                                                                                        <p>奖金池占比(%)</p>
                                                                                    </div>
                                                                                    <div class="number col-md-4">
                                                                                        <p>奖励人数或轮次(参与奖时)</p>
                                                                                    </div>
                                                                                </li>
                                                                                <li class="addlist_input" style="list-style:none;display:flex;margin-top:15px;line-height:2em;" ng-repeat="plan in group.planlist">
                                                                                    <div class="bonus col-md-4">
                                                                                        <select class="inputtext noempty"  ng-options="x.id as x.name for x in plan.ChooseBonusList" ng-model="plan.BonusID"
                                                                                                ng-change="ChangeBonusID(plan)">
                                                                                        </select>
                                                                                    </div>
                                                                                    <div class="bonus col-md-4">
                                                                                        <input class="inputnums" type="text" placeholder="比如：一等奖" ng-model="plan.name">
                                                                                    </div>
                                                                                    <div class="bonusRatio col-md-4">
                                                                                        <input class="inputnums" type="text" onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9]+/,'');}).call(this)"
                                                                                            ng-blur="CheckValidPlan(plan, 1)"
                                                                                            placeholder="请输入100以内的数字" ng-model="plan.Amount">
                                                                                    </div>
                                                                                    <div class="number col-md-4" ng-hide="plan.showRoundLimit">
                                                                                        <input type="text" class="inputnums" onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9]+/,'');}).call(this)"
                                                                                               ng-blur="CheckValidPlan(plan, 3)" placeholder="请输入奖励人数"
                                                                                               ng-model="plan.PersonNum">
                                                                                    </div>
                                                                                    <div class="number col-md-4" ng-show="plan.showRoundLimit">
                                                                                        <input type="text" class="inputnums" onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9]+/,'');}).call(this)"
                                                                                               ng-blur="CheckValidPlan(plan, 4)" placeholder="请输入轮次数"
                                                                                               ng-model="plan.round_limit">
                                                                                    </div>
                                                                                    <div class="delect col-md-1">
                                                                                        <button style="height: 30px;
                                                                background-color: #fff;
                                                                border-radius: 0.4em;
                                                                color: red;border: 1px solid red;" ng-hide="ShowPlanOper(plan, group.planlist)"
                                                                                            class="delectbutton addinpt" ng-click="DelPlan(group.planlist, plan)">
                                                                                            －
                                                                                        </button>
                                                                                        <button style="height: 30px;
                                                                background-color: #61b72b;
                                                                border-radius: 0.4em;
                                                                color: #fff;border: 1px solid #61b72b;" ng-show="ShowPlanOper(plan, group.planlist)"
                                                                                            class="delectbutton addinpt" ng-click="AddPlan(group.planlist)">
                                                                                            ＋
                                                                                        </button>
                                                                                    </div>
                                                                                </li>
                                                                                <p style="color: blue;margin-top: 10px;text-align: center;">
                                                                                    注意1：奖金池占比---指每个获奖人的奖金比例。</p>

                                                                                <p style="color: red;margin-top: 10px;text-align: center;">
                                                                                    注意2：所有人的奖金占比之和不得超过100。</p>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- 固定奖金模板 -->
                                                                <div class="row" ng-show="group.showfixplan">
                                                                    <div class="col-md-12">
                                                                        <ul class="list2">
                                                                            <li class="list_head" style=" list-style:none;display:flex;position: relative;width: 100%;">
                                                                                <div class="bonus col-md-4">
                                                                                    <p>奖励类型</p>
                                                                                </div>
                                                                                <div class="bonus col-md-4">
                                                                                    <p>奖励等级</p>
                                                                                </div>
                                                                                <div class="bonusRatio col-md-4">
                                                                                    <p>奖金(元)</p>
                                                                                </div>
                                                                                <div class="number col-md-4">
                                                                                    <p>奖励人数或轮次(参与奖时)</p>
                                                                                </div>
                                                                            </li>
                                                                            <li class="addlist_input" style=" list-style:none;display:flex;margin-top: 15px;line-height: 2em;" ng-repeat="plan in group.planlist">
                                                                                <div class="bonus col-md-4">
                                                                                    <select class="inputtext noempty"  ng-options="x.id as x.name for x in plan.ChooseBonusList" ng-model="plan.BonusID"
                                                                                            ng-change="ChangeBonusID(plan)">
                                                                                    </select>
                                                                                </div>
                                                                                <div class="bonus col-md-4">
                                                                                    <input type="text" class="inputnums" placeholder="比如：一等奖" ng-model="plan.name">
                                                                                </div>
                                                                                <div class="bonusRatio col-md-4">
                                                                                    <input type="text" class="inputnums" onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9]+/,'');}).call(this)"
                                                                                        ng-blur="CheckValidPlan(plan, 2)" placeholder="请输入奖金金额(元)"
                                                                                        ng-model="plan.Amount">
                                                                                </div>
                                                                                <div class="number col-md-4" ng-hide="plan.showRoundLimit">
                                                                                    <input type="text" class="inputnums" onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9]+/,'');}).call(this)"
                                                                                        ng-blur="CheckValidPlan(plan, 3)" placeholder="请输入奖励人数"
                                                                                        ng-model="plan.PersonNum">
                                                                                </div>
                                                                                <div class="number col-md-4" ng-show="plan.showRoundLimit">
                                                                                    <input type="text" class="inputnums" onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9]+/,'');}).call(this)"
                                                                                           ng-blur="CheckValidPlan(plan, 4)" placeholder="请输入轮次数"
                                                                                           ng-model="plan.round_limit">
                                                                                </div>
                                                                                <div class="delect col-md-2">
                                                                                    <button style="height: 30px;
                                            background-color: #fff;
                                            border-radius: 0.4em;
                                            color: red;border: 1px solid red;" ng-hide="ShowPlanOper(plan, group.planlist)"
                                                                                        class="delectbutton addinpt" ng-click="DelPlan(group.planlist, plan)">
                                                                                        －
                                                                                    </button>
                                                                                    <button style="height: 30px;
                                        background-color: #61b72b;
                                        border-radius: 0.4em;
                                        color: #fff;border: 1px solid #61b72b;" ng-show="ShowPlanOper(plan, group.planlist)"
                                                                                        class="delectbutton addinpt" ng-click="AddPlan(group.planlist)">
                                                                                        ＋
                                                                                    </button>
                                                                                </div>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- 轮次区域 -->
                                                    <div class="sameStyle">
                                                        <h4>轮次信息</h4>
                                                        <div  class="row">
                                                            <div class="form-group" style="height: 30px;margin-bottom:0;">
                                                                <!-- <div class="col-md-1" style="margin-left: 10px;">间隔时间：</div> -->
                                                                <div class="col-md-10">
                                                                    <div style="display:flex;align-items: center;white-space: nowrap;" class="col-md-12">
                                                                        <div class="col-md-3 col-sm-4 col-lg-2 text-right" style="padding-left: 0;">
                                                                            <div>关闭对阵表自动发表：</div>

                                                                        </div>
                                                                        <div class="col-md-6 col-lg-4 col-xs-6" style=" display: flex;align-items: center;justify-content: flex-start;align-items: center;padding-left: 0;">
                                                                            <div style=" display: flex;align-items: center;justify-content: flex-start;padding-left: 0;" class="col-md-3 col-lg-2 col-xs-4">
                                                                                <img style="width:3rem;" ng-src="{{group.manualnotice ? 'https://scdn.kaisaile.org/image/png/btnopen.png' : 'https://scdn.kaisaile.org/image/png/btnoff.png'}}"
                                                                                     alt="" class="btnonoff" ng-click="group.manualnotice=!group.manualnotice"
                                                                                        />
                                                                                <span ng-show="group.manualnotice" style="margin-left: 80px;"><input  type="number" ng-model="group.manualdelay" min="0">&nbsp;&nbsp;分钟</span>
                                                                            </div>
                                                                            <span style="position:relative" >
                                                                        <img src="__ROOT__/activity/images/help.png" class="competitionhelp"  ng-mouseover="changeHit('manualnotice')" ng-mouseleave="changeHit('manualnotice')" >
                                                                        <div class="competitionhint" id="manualnotice">
                                                                            <h6 class="text-center"></h6>
                                                                            <p style="text-indent: 2em;">开启后需要赛事操作员在对阵表点击“发布对阵表”选手才可见对阵表</p>
                                                                        </div>
                                                                        </span>
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row" ng-show="hdinfo.ext_catgory == 1 && (!group.needsign || group.ticketPair == 1)">
                                                            <div class="form-group" style="height: 30px;margin-bottom:0;">
                                                                <!-- <div class="col-md-1" style="margin-left: 10px;">间隔时间：</div> -->
                                                                <div class="col-md-10">
                                                                    <div style="display:flex;align-items: center;white-space: nowrap;" class="col-md-12">
                                                                        <div class="col-md-3 col-sm-4 col-lg-2 text-right" style="padding-left: 0;">
                                                                            <div>上轮结束立即开始下轮：</div>
                                                                        </div>
                                                                        <div class="col-md-6 col-lg-4 col-xs-6" style=" display: flex;align-items: center;justify-content: flex-start;align-items: center;padding-left: 0;">
                                                                            <div style=" display: flex;align-items: center;justify-content: flex-start;padding-left: 0;" class="col-md-3 col-lg-2 col-xs-4">
                                                                                <img style="width:3rem;" ng-src="{{group.roundautojust ? 'https://scdn.kaisaile.org/image/png/btnopen.png' : 'https://scdn.kaisaile.org/image/png/btnoff.png'}}"
                                                                                    alt="" class="btnonoff" ng-click="group.roundautojust=!group.roundautojust"
                                                                                />
                                                                            </div>
                                                                            <div ng-show="group.roundautojust" class="col-md-6 col-lg-9 col-xs-6 justTime" style="padding-right:0;">
                                                                                <input type="number" class="wTime" placeholder="请输入轮次间隔时间，不填默认1" ng-model="group.roundjusttime" min="1">
                                                                                <!-- <span>分钟</span> -->
                                                                            </div>
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row" ng-show="hdinfo.ext_catgory == 1  && hdinfo.ext_type == 0 &&(!group.roundautojust || group.ticketPair == 1)">
                                                            <div class="form-group" style="height: 30px;margin-bottom:0;">
                                                                <!-- <div class="col-md-1" style="margin-left: 10px;">间隔时间：</div> -->
                                                                <div class="col-md-10">
                                                                    <div style="display:flex;align-items: center;white-space: nowrap;" class="col-md-12">
                                                                        <div class="col-md-3 col-sm-4 col-lg-2 text-right" style="padding-left: 0;">
                                                                            <div>是否赛前签到：</div>
                                                                        </div>
                                                                        <div class="col-md-6 col-lg-4 col-xs-6" style=" display: flex;align-items: center;justify-content: flex-start;align-items: center;padding-left: 0;">
                                                                            <div style=" display: flex;align-items: center;justify-content: flex-start;padding-left: 0;" class="col-md-3 col-lg-2 col-xs-4">
                                                                                <img style="width:3rem;" ng-src="{{group.needsign ? 'https://scdn.kaisaile.org/image/png/btnopen.png' : 'https://scdn.kaisaile.org/image/png/btnoff.png'}}"
                                                                                     alt="" class="btnonoff" ng-click="group.needsign=!group.needsign"
                                                                                        />
                                                                            </div>
<span style="position:relative">
    <img src="__ROOT__/activity/images/help.png" class="competitionhelp" ng-mouseover="changeHit('needsign')" ng-mouseleave="changeHit('needsign')">
    <div class="competitionhint" id="needsign">
        <h6 class="text-center"></h6>
        <p style="text-indent: 2em;">开关一旦打开后需棋手进行签到，只要做签到准备的人才会被进行编排。</p>
    </div>
</span>
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row" ng-show="hdinfo.ext_catgory == 1 && group.needsign">
                                                            <div class="form-group" style="height: 30px;margin-bottom:0;">
                                                                <div class="col-md-10">
                                                                    <div style="display:flex;align-items: center;white-space: nowrap;" class="col-md-12">
                                                                        <div class="col-md-3 col-sm-4 col-lg-2 text-right" style="padding-left: 0;">
                                                                            <div>签到时间：</div>
                                                                        </div>
                                                                        <div class="col-md-6 col-lg-4 col-xs-6" style=" display: flex;align-items: center;justify-content: flex-start;align-items: center;padding-left: 0;">
                                                                            <div ng-show="group.needsign" class="col-md-6 col-lg-9 col-xs-6 justTime" style="padding-right:0;">
                                                                                赛前开始：<input type="number" class="wTime" placeholder="请输入和比赛开始的间隔时间" ng-model="group.sign_start_time" min="1">
                                                                                <!-- <span>分钟</span> -->
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-6 col-lg-4 col-xs-6" style=" display: flex;align-items: center;justify-content: flex-start;align-items: center;padding-left: 0;">
                                                                            <div ng-show="group.needsign" class="col-md-6 col-lg-9 col-xs-6 justTime" style="padding-right:0;">
                                                                                赛前截止：<input type="number" class="wTime" placeholder="请输入和比赛开始的间隔时间" ng-model="group.sign_end_time" min="1">
                                                                                <!-- <span>分钟</span> -->
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row" ng-show="hdinfo.ext_catgory == 1 && group.needsign && group.ticketPair!=1 && group.ticketPair!=4">
                                                            <div class="form-group" style="height: 30px;margin-bottom:0;">
                                                                <div class="col-md-10">
                                                                    <div style="display:flex;align-items: center;white-space: nowrap;" class="col-md-12">
                                                                        <div class="col-md-3 col-sm-4 col-lg-2 text-right" style="padding-left: 0;">
                                                                            <div>是否强制每轮签到：</div>
                                                                        </div>
                                                                        <div class="col-md-6 col-lg-4 col-xs-6" style=" display: flex;align-items: center;justify-content: flex-start;align-items: center;padding-left: 0;">
                                                                            <div style=" display: flex;align-items: center;justify-content: flex-start;padding-left: 0;" class="col-md-3 col-lg-2 col-xs-4">
                                                                                <img style="width:3rem;" ng-src="{{group.forcesign ? 'https://scdn.kaisaile.org/image/png/btnopen.png' : 'https://scdn.kaisaile.org/image/png/btnoff.png'}}"
                                                                                     alt="" class="btnonoff" ng-click="group.forcesign=!group.forcesign"
                                                                                        />
                                                                            </div>

                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row form-group" style="margin-top: 1em;">
                                                            <div ng-repeat="round in group.ticketRound">
                                                                <div class="timebox form-group" style="padding-left:0">
                                                                    <div class="col-md-12" style="margin-bottom: 1em">
                                                                        <div class="text-right Height36 col-md-2 col-sm-4">第
                                                                            <span ng-bind="$index+1"></span>轮:
                                                                        </div>
                                                                        <div class="col-md-6 col-lg-10 col-xs-12" style="display: flex;">
                                                                            <div class="col-md-4 col-lg-3 col-xs-6" style=" padding-right: 0;">
                                                                                <label class="inputtext noempty" ng-click="ChooseRoundTime(group, round)" ng-bind="round" style="cursor: pointer">
                                                                                </label>
                                                                            </div>
                                                                            <div class="Height36 del col-md-2" style="padding: 0 12px;" ng-click="DelRound(group, round)">删除</div>
                                                                        </div>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-12 col-lg-12">
                                                                <div class="col-md-2 col-sm-4"></div>
                                                                <div class="col-md-6 col-lg-10 col-xs-12" style="padding-right:0;">
                                                                    <div class="col-md-4 col-lg-3 col-xs-6" style="padding-right:0;">
                                                                        <button style="width:100%;" class="addbutton" ng-click="AddRound(group)">+&nbsp;&nbsp;添加轮次
                                                                        </button>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row form-group">
                                                            <div class="text-center col-md-4" style="padding-left:17rem;">
                                                                <button class="no cancelBtn" ng-click="ConfirmCancel()">取消
                                                                </button>
                                                                <button class="yes" style="margin-left: 0.5rem;" ng-click="ConfirmGroup(group)">确定
                                                                </button>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 点击确定之后显示内容 -->
                                <div class="col-md-12 yesSave" ng-hide="group.showdetail==1">
                                    <div class="col-md-11">
                                        <h5 ng-bind="group.ticketName"></h5>
                                        <!-- lxq-2019-1-28 -->
                                        <div ng-show="hdinfo.ext_type != 1 && hdinfo.ext_type != 2" class="hdinfo">
                                            <div class="" style="margin-bottom:10px;display: inline-block;margin-right: 20px;">
                                                <div class="bot10" style=" width: 180px;">时制：
                                                    <span ng-bind="group.ticketTime"></span>+
                                                    <span ng-bind="group.ticketAdd"></span>
                                                </div>
                                                <div class="bot10">
                                                    报名条件：
                                                    <span ng-bind="group.ticketNeedauth ? '实名认证' : '无需认证'"></span>
                                                </div>
                                                <div class="bot10">
                                                    等级分：
                                                    <span ng-bind="group.ticketEloMin==-1?'不限':group.ticketEloMin"></span>~
                                                    <span ng-bind="group.ticketEloMax==-1?'不限':group.ticketEloMax"></span>
                                                </div>
                                            </div>
                                            <!-- lxq-2019-1-28 -->
                                            <div style="margin-bottom:10px;display: inline-block;margin-right: 20px;">
                                                <div class="bot10">报名费：
                                                    <span ng-bind="group.ticketPrice | filterFix"></span>元</div>
                                                <div class="bot10" ng-bind="group.ticketEloEffect==1?'记录等级分':'不记录等级分'"></div>
                                                <div class="bot10 ">报名人数：<span ng-bind="group.ticketNum <= 0 ? '不限' : group.ticketNum"></span>人</div>
                                            </div>
                                            <div style="display: inline-block;margin-right: 20px;">
                                                <div class="bot10" style="white-space: nowrap;">比赛类型：
                                                    <span ng-bind="group.ticketType | filterCompType : comptypes" class="typename"></span>
                                                </div>
                                                <div class="bot10">性别：
                                                    <span ng-bind="group.ticketLimitSex==1?'男':(group.ticketLimitSex==2?'女':'不限')"></span>
                                                </div>
                                                <div class="bot10">自主退费：
                                                    <span ng-bind="group.refundbysign == '1'?'否':'是'"></span>
                                                </div>
                                            </div>
                                            <div style="display: inline-block;margin-right: 20px;">
                                                <div class="bot10">编排方式：
                                                    <span ng-bind="comppairs[group.ticketPair].name"></span>
                                                </div>
                                                <div class="bot10">年龄：
                                                    <span ng-show="group.ticketAgeMin==-1 && group.ticketAgeMax==-1">不限</span>
                                                    <span ng-show="group.ticketAgeMin!=-1 && group.ticketAgeMax==-1"><span ng-bind="group.ticketAgeMin | filterFormatDate"></span> 之后出生</span>
                                                    <span ng-show="group.ticketAgeMin==-1 && group.ticketAgeMax!=-1"><span ng-bind="group.ticketAgeMax | filterFormatDate"></span> 之前出生</span>
                                                    <span ng-show="group.ticketAgeMin!=-1 && group.ticketAgeMax!=-1">
                                                        <span ng-bind="group.ticketAgeMin | filterFormatDate"></span>~<span ng-bind="group.ticketAgeMax | filterFormatDate"></span>
                                                    </span>

                                                </div>
                                                <div class="bot10 seize">占位符</div>
                                            </div>
                                            <div style="display: inline-block;margin-right: 20px;">
                                                <div class="bot10" style="white-space: nowrap;">
                                                    棋力等级：
                                                    <span ng-bind="group.ticketLevelMin==-1?'不限':levelLists[group.ticketLevelMin+1].name"></span>~
                                                    <span ng-bind="group.ticketLevelMax==-1?'不限':levelLists[group.ticketLevelMax+1].name"></span>
                                                </div>
                                                <div class="bot10 seize">占位符</div>
                                                <div class="bot10 seize">占位符</div>
                                            </div>


                                        </div>

                                        <div style="display:flex;" ng-show="hdinfo.ext_type == 1 || hdinfo.ext_type == 2">
                                            <!-- 时制和报名条件 -->
                                            <div style="margin-right:40px;">
                                                <div class="bot10 nowrap">时制：
                                                    <span ng-bind="group.ticketTime"></span>+
                                                    <span ng-bind="group.ticketAdd"></span>
                                                </div>
                                                <div class="bot10 nowrap">报名条件：
                                                    <span ng-bind="group.ticketNeedauth ? '实名认证' : '无需认证'"></span>
                                                </div>
                                                <div class="bot10 nowrap">
                                                    等级分：
                                                    <span ng-bind="group.ticketEloMin==-1?'不限':group.ticketEloMin"></span>~
                                                    <span ng-bind="group.ticketEloMax==-1?'不限':group.ticketEloMax"></span>
                                                </div>
                                            </div>
                                            <!-- 报名费和等级分 -->
                                            <div style="margin-right: 30px;">
                                                <div class="bot10 nowrap">报名费：
                                                    <span ng-bind="group.ticketPrice | filterFix"></span>元</div>
                                                <div class="bot10 nowrap" ng-bind="group.ticketEloEffect==1?'记录等级分':'不记录等级分'"></div>
                                                <div ng-show="group.vipflag==1 || group.vipflag==3">白银VIP免费</div>
                                                <div ng-show="group.vipflag==2 || group.vipflag==3">特惠VIP免费</div>
                                            </div>
                                            <!-- 人数和性别 -->
                                            <div style="margin-right: 30px;">
                                                <div class="bot10 nowrap">人数：
                                                    <span ng-bind="group.ticketSignCount"></span>人</div>
                                                <div class="bot10 nowrap">性别：
                                                    <span ng-bind="group.ticketLimitSex==1?'男':(group.ticketLimitSex==2?'女':'不限')"></span>
                                                </div>
                                            </div>
                                            <!-- 比赛类型和年龄 -->
                                            <div style="margin-right: 30px;">
                                                <div class="bot10 nowrap">比赛类型：
                                                    <span ng-bind="group.ticketType | filterCompType : comptypes"></span>
                                                </div>
                                                <div class="bot10 nowrap">年龄：
                                                    <span ng-show="group.ticketAgeMin==-1 && group.ticketAgeMax==-1">不限</span>
                                                    <span ng-show="group.ticketAgeMin!=-1 && group.ticketAgeMax==-1"><span ng-bind="group.ticketAgeMin | filterFormatDate"></span> 之后出生</span>
                                                    <span ng-show="group.ticketAgeMin==-1 && group.ticketAgeMax!=-1"><span ng-bind="group.ticketAgeMax | filterFormatDate"></span> 之前出生</span>
                                                    <span ng-show="group.ticketAgeMin!=-1 && group.ticketAgeMax!=-1">
                                                        <span ng-bind="group.ticketAgeMin | filterFormatDate"></span>~<span ng-bind="group.ticketAgeMax | filterFormatDate"></span>
                                                    </span>
                                                </div>
                                            </div>
                                            <!-- 编排方式和棋力等级 -->
                                            <div>
                                                <div class="bot10 nowrap">编排方式：
                                                    <span ng-bind="comppairs[group.ticketPair].name"></span>
                                                </div>
                                                <div class="bot10 nowrap" style="white-space: nowrap;margin-right: 40px;">
                                                    棋力等级：
                                                    <span ng-bind="group.ticketLevelMin==-1?'不限':levelLists[group.ticketLevelMin+1].name"></span>~
                                                    <span ng-bind="group.ticketLevelMax==-1?'不限':levelLists[group.ticketLevelMax+1].name"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bot10" >通知模式：
                                            <span ng-bind="group.manualnotice ? '手动' : '自动'"></span>
                                            <span ng-show="group.manualnotice">延时时间：{{group.manualdelay}} 分钟</span>
                                        </div>
                                        <div class="bot10" ng-show="hdinfo.ext_catgory == 1 && group.roundautojust">轮次自动调整时间间隔：
                                            <span ng-bind="group.roundjusttime || 1"></span>分钟
                                        </div>
                                        <div class="bot10" ng-show="hdinfo.ext_catgory == 1 && group.needsign">签到开始时间：
                                            <span ng-bind="group.sign_start_time || 15"></span>分钟
                                        </div>
                                        <div class="bot10" ng-show="hdinfo.ext_catgory == 1 && group.needsign">签到截止时间：
                                            <span ng-bind="group.sign_end_time || 1"></span>分钟
                                        </div>
                                        <div class="bot10" ng-show="hdinfo.ext_catgory == 1 && group.needsign">是否强制每轮签到：
                                            <span ng-bind="group.forcesign ? '是' : '否'"></span>
                                        </div>
                                        <div ng-repeat="round in group.ticketRound">
                                            <p>第
                                                <span ng-bind="$index+1"></span>轮：
                                                <span ng-bind="round"></span>
                                            </p>
                                        </div>
                                        <div class="proportion" ng-hide="group.ticketPrice==0 || !showdistribution">
                                            <p>报名费分账占比：&nbsp; 奖金
                                                <span ng-bind="group.Percent_Winner"></span>%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 开赛了平台
                                                <span ng-bind="group.Percent_PlatForm"></span>%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 主办方
                                                <span ng-bind="group.Percent_Leader"></span>%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{hdinfo.ext_catgory==11 ? '协办方' : '参赛方'}}
                                                <span ng-bind="group.Percent_Club"></span>%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;推广方
                                                <span ng-bind="group.Percent_Share"></span>%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;承办方
                                                <span ng-bind="group.Percent_Organizer"></span>%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                <span ng-show="hdinfo.ext_catgory==11">指定机构<span ng-bind="group.Percent_Design_Club"></span>%</span>
                                                <span ng-show="hdinfo.ext_catgory==6">场地方<span ng-bind="group.Percent_Zone"></span>%</span>
                                            </p>
                                        </div>
                                        <div class="col-md-12" style="padding: 0;margin-left: -24px;" ng-if="group.ticketBonus>0">
                                            <div ng-hide="group.ticketPair==1">
                                                <ul class="listshow1" style="list-style-type: none;" ng-show="!group.showfixplan">
                                                    <h5 style="font-size: 15px;">奖励说明</h5>
                                                    <li class="list_head" style="text-align: center;">
                                                        <div class="bonus col-md-2">
                                                            <p>奖励等级</p>
                                                        </div>
                                                        <div class="bonusRatio col-md-2">
                                                            <p>奖金池占比(%)</p>
                                                        </div>
                                                        <div class="number col-md-2">
                                                            <p>奖励人数或轮次(参与奖时)</p>
                                                        </div>
                                                    </li>
                                                    <div class="col-md-12" ng-repeat="plan in group.planlist">
                                                        <li class="list_head" style="text-align: center;">
                                                            <div class="bonus col-md-2">
                                                                <p>
                                                                    <span ng-bind="plan.name"></span>
                                                                </p>
                                                            </div>
                                                            <div class="bonus col-md-2">
                                                                <p>
                                                                    <span ng-bind="plan.Amount"></span>%</p>
                                                            </div>
                                                            <div class="bonus col-md-2" ng-show="plan.PersonNum > 0">
                                                                <p>
                                                                    <span ng-bind="plan.PersonNum"></span>人</p>
                                                            </div>
                                                            <div class="bonus col-md-2" ng-hide="plan.PersonNum > 0">
                                                                <p>
                                                                    至少<span ng-bind="plan.round_limit"></span>轮</p>
                                                            </div>
                                                        </li>
                                                    </div>
                                                </ul>
                                                <ul class="listshow2" style="list-style-type: none;" ng-show="group.showfixplan">
                                                    <!-- <p style="font-size: 15px;">奖励说明</p> -->
                                                    <li class="list_head" style="text-align: center;">
                                                        <div class="bonus col-md-2">
                                                            <p>奖励等级</p>
                                                        </div>
                                                        <div class="bonusRatio col-md-2">
                                                            <p>奖金(元)</p>
                                                        </div>
                                                        <div class="number col-md-2">
                                                            <p>奖励人数或轮次(参与奖时)</p>
                                                        </div>
                                                    </li>
                                                    <div class="col-md-12" ng-repeat="plan in group.planlist">
                                                        <li class="list_head" style="text-align: center;">
                                                            <div class="bonus col-md-2">
                                                                <p>
                                                                    <span ng-bind="plan.name"></span>
                                                                </p>
                                                            </div>
                                                            <div class="bonus col-md-2">
                                                                <p>
                                                                    <span ng-bind="plan.Amount"></span>元</p>
                                                            </div>
                                                            <div class="bonus col-md-2" ng-show="plan.PersonNum > 0">
                                                                <p>
                                                                    <span ng-bind="plan.PersonNum"></span>人</p>
                                                            </div>
                                                            <div class="bonus col-md-2" ng-hide="plan.PersonNum > 0">
                                                                <p>
                                                                    至少<span ng-bind="plan.round_limit"></span>轮</p>
                                                            </div>
                                                        </li>
                                                    </div>
                                                </ul>
                                            </div>
                                            <div ng-show="group.ticketPair==1" style="text-indent: 25px;">
                                                <p style="font-style: bold;">奖励说明</p>
                                                <div ng-if="group.ticketPrice < 100 && group.ticketPrice != 20 && group.ticketPrice != 10">
                                                    <p>1、各组积分最高者获“冠军奖”奖励50元，如最高分有两人及两人以上，则平分50元。</p>
                                                    <p>2、最后一轮获胜者得“坚持奖”奖励10元，如最后一轮和棋，则平分10元。</p>
                                                </div>
                                                <div ng-if="group.ticketPrice == 100">
                                                    <p>1、各组积分最高者获“冠军奖”奖励50元，如最高分有两人及两人以上，则平分200元。</p>
                                                    <p>2、最后一轮获胜者得“坚持奖”奖励10元，如最后一轮和棋，则平分40元。</p>
                                                </div>
                                                <div ng-show="group.ticketPrice == 20">
                                                    <p>1、各组积分最高者获“冠军奖”奖励40元，如最高分有两人及两人以上，则平分40元。</p>
                                                    <p>2、最后一轮获胜者得“坚持奖”奖励6元，如最后一轮和棋，则平分6元。</p>
                                                </div>
                                                <div ng-show="group.ticketPrice == 10">
                                                    <p>1、各组积分最高者获“冠军奖”奖励20元，如最高分有两人及两人以上，则平分20元。</p>
                                                    <p>2、最后一轮获胜者得“坚持奖”奖励3元，如最后一轮和棋，则平分3元。</p>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                    <div class="col-md-1 text-center operatebox">
                                        <div class="row" ng-click="group.showdetail=1">
                                            <span ng-mouseenter="showEditfocus=true" ng-mouseleave="showEditfocus=false">
                                                <img ng-show="!showEditfocus" src="__ROOT__/activity/images/edit.png" alt="" class="edit">
                                                <img ng-show="showEditfocus" src="__ROOT__/activity/images/editcur.png" alt="" class="edit">
                                            </span>

                                        </div>
                                        <div class="row" ng-click="ClickOper(group)">
                                            <span ng-mouseenter="showDelfocus=true" ng-mouseleave="showDelfocus=false">
                                                <img ng-show="!showDelfocus" src="__ROOT__/activity/images/del.png" alt="" class="delete">
                                                <img ng-show="showDelfocus" src="__ROOT__/activity/images/delcur.png" alt="" class="delete">
                                            </span>

                                        </div>

                                        <i class="line"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12" style="padding-left: 0">
                                <button class="addteam" ng-click="AddGroup()">+&nbsp;&nbsp;添加比赛组</button>
                            </div>
                            <div class="col-md-12 pagelink text-center" style="margin: 2em 0 4em;">
                                <span ng-bind="errmsg" style="color: red"></span>
                            </div>
                            <div class="col-md-12 pagelink text-center">
                                <a href="javascript:;" ng-click="SubmitGroups(false)">上一步</a>
                                <a href="javascript:;" class="cur" ng-click="SubmitGroups(true)">发布</a>
                            </div>
                        </div>
                    </div>
                    <div id="birth_modal" class="modal fade" role="dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h5 class="modal-title">选择年龄限制(出生日期)</h5>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-9">
                                                <div class="col-md-5" style="padding: 0px;">
                                                    <input id="birthbegin" type="text" class="stateSel Wdate form-control noempty">
                                                </div>
                                                <div class="col-md-1 text-center fontcolor">~</div>
                                                <div class="col-md-5" style="padding: 0px;">
                                                    <input id="birthend" type="text" class="form-control stateSel Wdate noempty">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn bg-info-600" data-dismiss="modal" ng-click="SetBirth()">确定
                                    </button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="round_modal" class="modal fade" role="dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h5 class="modal-title">选择轮次时间</h5>
                                </div>
                                <div class="modal-body">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-9">
                                                <div class="col-md-5" style="padding: 0px;">
                                                    <input id="roundtime" type="text" class="stateSel Wdate form-control noempty">
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn bg-info-600" data-dismiss="modal" ng-click="SetRoundTime()">确定
                                    </button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="del_modal1" class="modal fade" role="dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h5 class="modal-title">警告！</h5>
                                </div>
                                <div class="modal-body">
                                    您将删除当前分组，确定吗？
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn bg-info-600" ng-click="DelGroup()" data-dismiss="modal">是，确定
                                    </button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">不，谢谢</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="act-success" class="ewm" ng-click="backActList()">
                        <div class="successContent" ng-click="stop($event)">
                            <div class="success-header">
                                <p id="successTitle">{{data.title}}</p>
                                <p>
                                    <span id="successStarttime">{{data.starttime}}</span>~
                                    <span id="successEndtime">{{data.endtime}}</span>
                                </p>
                            </div>
                            <div>
                                <div class="successok">发布成功 ！</div>
                                <p class="text-center" style="font-size: 18px;">{{hdinfo.title}}</p>
                                <div id="code"></div>
                                <p class="text-center" ng-show="hdinfo.ext_type == 0">分享比赛让棋手报名或通过下方入口添加报名人</p>
                                <div class="text-center" ng-show="hdinfo.ext_type == 1 || hdinfo.ext_type == 2">
                                    <p class="margin0">复制二维码让相关领队报名</p>
                                    <p class="">领队报名成功后发送二维码让棋手报名</p>
                                </div>
                            </div>
                            <div>
                                <!-- <div class="linkadress"> 
                                    链接： <input type="text" value="" placeholder="活动详情地址" class="inputvalue" id="Copy"> <button ng-click="copyLink()" class="btncopy">复制</button> 
                                    <span class="copyok">复制成功！</span>
                                </div> -->
                                <div class="btns">
                                    <button ng-click="previewPage(evt)">预览</button>
                                    <button ng-click="addPersonnel(evt)" ng-show="hdinfo.ext_type == 0">添加报名人</button>
                                </div>
                                <img src="https://webcdn.kaisaile.org/cha.png" alt="" class="close" ng-click="linkList(evt)">
                            </div>
                        </div>
                    </div>
                    <div id="addLabel_modal" class="modal fade" role="dialog">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">×</button>
                                    <h5 class="modal-title">请选择分账机构</h5>
                                </div>
                                <div class="modal-body">
                                    <div>当前分账机构：<span ng-bind="currSponsor.name"></span></div>
                                    <div class="modal-body">
                                        <div class="form-group"
                                             style="width: 100%;overflow-x: auto;">
                                            <table class="table text-center table-hover" id="sponsorlist_table">
                                                <thead>
                                                <tr>
                                                    <th class="text-center">机构ID</th>
                                                    <th class="text-center">名称</th>
                                                    <th class="text-center">负责人</th>
                                                    <th class="text-center">加入时间</th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                        <input type="submit" class="btn bg-info-600" ng-click="SetSponsor()" value="提交" ng-show="userSubmitBtn">
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>


                    <include file="Template/Public/Yb_footer" />
                </div>
            </div>
            <!-- Footer -->
            <!-- <include file="Template/Public/Yb_footer" /> -->
            <!-- /footer -->
        </div>
        <!-- /content area -->
    </div>
    <!-- /main content -->
    </div>
    <!-- /page content -->
    </div>
    <!-- /page container -->
</body>
<script src="__PUBLIC__/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="__PUBLIC__/youbei/js/datatables/datatables.min.js"></script>
<!--artDialog-->
<link rel="stylesheet" href="__PUBLIC__/js/artDialog/skins/default.css?4.1.6">
<script src="__PUBLIC__/js/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="__PUBLIC__/js/artDialog/plugins/iframeTools.js"></script>
<script src="__PUBLIC__/js/jquery.qrcode.min.js"></script>

<script>
    // const VIP1_BIT = 0x01;
    const VIP1_BIT = 0x01;
    const VIP2_BIT = 0x02;
    var app = angular.module('costdetailApp', []);
    NumberFix(app);
    var menuobj = GetShowMenuList_yb();
    var jgObj = null;
    if (menuobj) {
        jgObj = menuobj.activeJg;
    }
    console.log(menuobj.ulevel);
    var rootpath = getRootPath();
    //    console.log(jgObj);
    var needauth = 0;
    app.controller('costdetailCtrl', function ($scope, $http, $timeout, $compile, $interval) {
        if (jgObj) {
            $scope.jgid = jgObj.jgid;
            $scope.jglevel = jgObj.level;
        }
        $scope.showdistribution = true;//显示分账配置
        var hdid = getUrlParam('hdid');
        var iscopy = getUrlParam('iscopy');
        var copyparams = '';
        if(iscopy){
            copyparams = "&iscopy=1";
        }
        var DEFAULT_PLATFORM = 10;
        var DEFAULT_CLUB = 10;
        var DEFAULT_LEADER = 50;
        var DEFAULT_ORGANIZER = 0;
        var DEFAULT_RATEZONE = 0;
        var DEFAULT_WINNER = 30;
        var DEFAULT_SHARER = 0;
        var DEFAULT_DESIGN_CLUB = 0;
        var DEFAULT_TICKETTIME = 10;
        var DEFAULT_TICKETADD = 15;
        var DEFAULT_SIGNSTARTTIME = 15;
        var DEFAULT_SIGNENDTIME = 1;
        var DEFAULT_PAIRTYPE = 4;
        GetDistributeBonusID();
        IsMatchDirector();
        GetDistributeRateRule();
        $scope.QPLAN_DEFAULT = [
            {
                "id": "1",
                "namespace_id": "5",
                "title": "Q赛奖金模板",
                "description": {
                    "Bonus_1": {
                        "Amount": 50,
                        "Mode": "冠军奖",
                        "PersonNum": 0
                    },
                    "Bonus_2": {
                        "Amount": 10,
                        "Mode": "坚持奖",
                        "PersonNum": 0
                    },
                    "Bonus_floor": 0,
                    "Bonus_top": 50000,
                    "Bonus_unit": "元",
                    "Percent_Club": 4,
                    "Percent_Leader": 18,
                    "Percent_PlatForm": 8,
                    "Percent_Winner": 70
                },
                "createby": "-1",
                "modifydate": getCurrDate(),
            }
        ];

        $scope.QPLAN_DEFAULT20 = [
            {
                "id": "2",
                "namespace_id": "5",
                "title": "Q赛奖金模板",
                "description": {
                    "Bonus_1": {
                        "Amount": 40,
                        "Mode": "冠军奖",
                        "PersonNum": 0
                    },
                    "Bonus_2": {
                        "Amount": 6,
                        "Mode": "坚持奖",
                        "PersonNum": 0
                    },
                    "Bonus_floor": 0,
                    "Bonus_top": 50000,
                    "Bonus_unit": "元",
                    "Percent_Club": 0,
                    "Percent_Leader": 30,
                    "Percent_PlatForm": 5,
                    "Percent_Winner": 65
                },
                "createby": "-1",
                "modifydate": getCurrDate(),
            }
        ];
        $scope.QPLAN_DEFAULT10 = [
            {
                "id": "3",
                "namespace_id": "5",
                "title": "Q赛奖金模板",
                "description": {
                    "Bonus_1": {
                        "Amount": 20,
                        "Mode": "冠军奖",
                        "PersonNum": 0
                    },
                    "Bonus_2": {
                        "Amount": 3,
                        "Mode": "坚持奖",
                        "PersonNum": 0
                    },
                    "Bonus_floor": 0,
                    "Bonus_top": 50000,
                    "Bonus_unit": "元",
                    "Percent_Club": 0,
                    "Percent_Leader": 30,
                    "Percent_PlatForm": 5,
                    "Percent_Winner": 65
                },
                "createby": "-1",
                "modifydate": getCurrDate(),
            }
        ];
        $scope.levelLists = [{
            'id': -1,
            'name': '不限'
        }, {
            'id': 0,
            'name': '无等级'
        }, {
            'id': 1,
            'name': '十五级棋士'
        }, {
            'id': 2,
            'name': '十四级棋士'
        }, {
            'id': 3,
            'name': '十三级棋士'
        }, {
            'id': 4,
            'name': '十二级棋士'
        }, {
            'id': 5,
            'name': '十一级棋士'
        }, {
            'id': 6,
            'name': '十级棋士'
        }, {
            'id': 7,
            'name': '九级棋士'
        }, {
            'id': 8,
            'name': '八级棋士'
        }, {
            'id': 9,
            'name': '七级棋士'
        }, {
            'id': 10,
            'name': '六级棋士'
        }, {
            'id': 11,
            'name': '五级棋士'
        }, {
            'id': 12,
            'name': '四级棋士'
        }, {
            'id': 13,
            'name': '三级棋士'
        }, {
            'id': 14,
            'name': '二级棋士'
        }, {
            'id': 15,
            'name': '一级棋士'
        }, {
            'id': 16,
            'name': '三级运动员/棋协候补大师'
        }, {
            'id': 17,
            'name': '二级运动员/棋协大师'
        }, {
            'id': 18,
            'name': '一级运动员'
        },
        {'id':19,'name':'棋联候补大师'},
        {'id':20,'name':'国家大师/棋联大师'},
        {'id':21,'name':'国际大师'},
        {'id':22,'name':'国际特级大师'},
        ];
        $scope.comptypes = [{
            'id': 0,
            'name': '标准全子赛'
        }, {
            'id': 960,
            'name': 'chess960'
        },{
            'id': 69566,
            'name': '小兵大战（无添子）'
        }, {
            'id': 69046,
            'name': '小兵大战（添车）'
        }, {
            'id': 67486,
            'name': '小兵大战（添马）'
        }, {
            'id': 68526,
            'name': '小兵大战（添象）'
        }, {
            'id': 69306,
            'name': '小兵大战（添后）'
        }, {
            'id': 66966,
            'name': '小兵大战（添车马）'
        }, {
            'id': 68006,
            'name': '小兵大战（添车象）'
        }, {
            'id': 68786,
            'name': '小兵大战（添车后）'
        }, {
            'id': 66446,
            'name': '小兵大战（添马象）'
        }, {
            'id': 67226,
            'name': '小兵大战（添马后）'
        }, {
            'id': 68266,
            'name': '小兵大战（添象后）'
        }, {
            'id': 65926,
            'name': '小兵大战（添车马象）'
        }, {
            'id': 66706,
            'name': '小兵大战（添车马后）'
        }, {
            'id': 67746,
            'name': '小兵大战（添车象后）'
        }, {
            'id': 66186,
            'name': '小兵大战（添马象后）'
        }, {
            'id': 65666,
            'name': '小兵大战（添车马象后）'
        }, ];
        $scope.comppairs = [{
            'id': 0,
            'name': '瑞士制'
        }, {
            'id': 1,
            'name': 'Q赛制'
        }, {
            'id': 2,
            'name': '单循环'
        }, {
            'id': 3,
            'name': '双循环'
        }, {
            'id': 4,
            'name': '自适应'
        }, ];
        $scope.QPairPrice = [{
            'id': 0,
            'name': '免费'
        }, {
            'id': 10,
            'name': '10元'
        }, {
            'id': 20,
            'name': '20元'
        }, {
            'id': 25,
            'name': '25元'
        }, {
            'id': 30,
            'name': '30元'
        }, {
            'id': 55,
            'name': '55元'
        }, {
            'id': 100,
            'name': '100元'
        }
        ];
        $scope.elos = [{
            'id': '不限',
            'name': '不限'
        }];
    var arr = ['0','100','200','300','400','450','500','600','700','800','900','1000','1100','1200','1300','1400','1500','1600','1700','1800','1900','2000','2100','2200','2300','2400','2500','2600','2700','2800','2900','3000']
        
        for (var i = 0; i < arr.length; i++) {
            var elo = {
                'id': arr[i],
                'name': arr[i],
            };
            $scope.elos.push(elo);
        }

        $('#birthbegin').bind('focus', function () {
            WdatePicker({
                onpicked: function () {

                },
                dateFmt: 'yyyyMMdd',
                autoPickDate: null,
                startDate: '%y%M%d',
                skin: 'whyGreen'
            });
        });
        $('#birthend').bind('focus', function () {
            WdatePicker({
                onpicked: function () {},
                dateFmt: 'yyyyMMdd',
                autoPickDate: null,
                startDate: '%y%M%d',
                skin: 'whyGreen'
            });
        });
        $('#roundtime').bind('focus', function () {
            WdatePicker({
                onpicked: function () {},
                dateFmt: 'yyyy-MM-dd HH:mm:ss',
                autoPickDate: null,
                startDate: '%y-%M-%d HH:mm:ss',
                skin: 'whyGreen'
            });
        });

        function isNotANumber(inputData) {　　
            if (inputData == "不限") {　　　　
                return false;　　
            } else {　　　　
                return true;　　
            }
        }
        GetDistributeTempList();
        $scope.ticketEloMinChange = function (group, value) {
            group.ticketEloMin = isNotANumber(value) ? value : -1;
        };
        $scope.ticketEloMaxChange = function (group, value) {
            group.ticketEloMax = isNotANumber(value) ? value : -1;
        };
        // 判断分成的合法性
        $scope.CheckValidDivide = function (group, checktotal) {
            if (parseFloat(group.ticketPrice) > 0) {
                var organizer = $scope.raterule.Percent_Organizer;
                var ratezone = $scope.raterule.Percent_Zone;
                if ($scope.hdinfo.ext_catgory == 1) {
                    platform = $scope.raterule.Percent_PlatForm;
                    club = $scope.raterule.Percent_Club;
                    leader = $scope.raterule.Percent_Leader;
                    winner = $scope.raterule.Percent_Winner;
                    sharer = $scope.raterule.Percent_Share;
                    designclub = $scope.raterule.Percent_Design_Club;
                    if (group.ticketPair == 1) {
                        platform = $scope.raterule.Percent_PlatForm_QPair;
                        club = $scope.raterule.Percent_Club_QPair;
                        leader = $scope.raterule.Percent_Leader_QPair;
                        winner = $scope.raterule.Percent_Winner_QPair;
                        sharer = $scope.raterule.Percent_Share_QPair;
                    }

                } else {
                    platform = $scope.raterule.Percent_PlatForm_Offline;
                    club = $scope.raterule.Percent_Club_Offline;
                    leader = $scope.raterule.Percent_Leader_Offline;
                    winner = $scope.raterule.Percent_Winner_Offline;
                    sharer = $scope.raterule.Percent_Share_Offline;
                    designclub = $scope.raterule.Percent_Design_Club;
                }

                if (!group.Percent_PlatForm) {
                    group.Percent_PlatForm = platform[0];
                }
                currPlatform = parseFloat(group.Percent_PlatForm);
                if (currPlatform < platform[0]) {
                    group.Percent_PlatForm = platform[0];
                    alert('开赛了平台的分配比例不能小于' + platform[0] + '%！');
                    return false;
                }
                if (currPlatform > platform[1]) {
                    group.Percent_PlatForm = platform[1];
                    alert('开赛了平台的分配比例不能大于' + platform[1] + '%！');
                    return false;
                }
                if (group.Percent_Club =='undefined' && group.ticketPair != 1) {
                    group.Percent_Club = DEFAULT_CLUB;
                }
                currClub = parseFloat(group.Percent_Club);
                if (currClub < club[0]) {
                    group.Percent_Club = club[0];
                    alert('参赛方的分配比例不能小于' + club[0] + '%！');
                    return false;
                }
                if (currClub > club[1]) {
                    group.Percent_Club = club[1];
                    alert('参赛方的分配比例不能大于' + club[1] + '%！');
                    return false;
                }
                if (group.Percent_Leader == 'undefined' && group.ticketPair != 1) {
                    group.Percent_Leader = DEFAULT_LEADER;
                }
                currLeader = parseFloat(group.Percent_Leader);
                if (currLeader < leader[0]) {
                    group.Percent_Leader = leader[0];
                    alert('主办方的分配比例不能小于' + leader[0] + '%！');
                    return false;
                }
                if (currLeader > leader[1]) {
                    group.Percent_Leader = leader[1];
                    alert('主办方的分配比例不能大于' + leader[1] + '%！');
                    return false;
                }
                if (group.Percent_Winner == 'undefined') {
                    group.Percent_Winner = DEFAULT_WINNER;
                }
                currWinner = parseFloat(group.Percent_Winner);
                if (currWinner < winner[0]) {
                    group.Percent_Winner = winner[0];
                    alert('奖金的分配比例不能小于' + winner[0] + '%！');
                    return false;
                }
                if (currWinner > winner[1]) {
                    group.Percent_Winner = winner[1];
                    alert('奖金的分配比例不能大于' + winner[1] + '%！');
                    return false;
                }
                if(group.Percent_Share == 'undefined'){
                    group.Percent_Share = DEFAULT_SHARER;
                }
                currSharer = parseFloat(group.Percent_Share);
                if (currSharer < sharer[0]) {
                    group.Percent_Share = sharer[0];
                    alert('推广方的分配比例不能小于' + sharer[0] + '%！');
                    return false;
                }
                if (currSharer > sharer[1]) {
                    group.Percent_Share = sharer[1];
                    alert('推广方的分配比例不能大于' + sharer[1] + '%！');
                    return false;
                }
                if (!group.Percent_Organizer || group.Percent_Organizer == 'undefined') {
                    group.Percent_Organizer = DEFAULT_ORGANIZER;
                }
                currOrganizer = parseFloat(group.Percent_Organizer);
                if (currOrganizer < organizer[0]) {
                    group.Percent_Organizer = organizer[0];
                    alert('承办方的分配比例不能小于' + organizer[0] + '%！');
                    return false;
                }
                if (currOrganizer > organizer[1]) {
                    group.Percent_Organizer = organizer[1];
                    alert('承办方的分配比例不能大于' + organizer[1] + '%！');
                    return false;
                }
                if (!group.Percent_Zone || group.Percent_Zone == 'undefined') {
                    group.Percent_Zone = DEFAULT_RATEZONE;
                }
                currZone = parseFloat(group.Percent_Zone);
                if (currZone < ratezone[0]) {
                    group.Percent_Zone = ratezone[0];
                    alert('场地方的分配比例不能小于' + ratezone[0] + '%！');
                    return false;
                }
                if (currZone > ratezone[1]) {
                    group.Percent_Zone = ratezone[1];
                    alert('场地方的分配比例不能大于' + ratezone[1] + '%！');
                    return false;
                }
                if (!group.Percent_Design_Club || group.Percent_Design_Club == 'undefined') {
                    group.Percent_Design_Club = DEFAULT_DESIGN_CLUB;
                }
                currDesignClub = parseFloat(group.Percent_Design_Club);
                if (currDesignClub < designclub[0]) {
                    group.Percent_Design_Club = designclub[0];
                    alert('指定机构的分配比例不能小于' + designclub[0] + '%！');
                    return false;
                }
                if (currDesignClub > designclub[1]) {
                    group.Percent_Design_Club = designclub[1];
                    alert('指定机构的分配比例不能大于' + designclub[1] + '%！');
                    return false;
                }
                if (checktotal) {
                    if (currDesignClub > 0.00001){
                        if (!group.Design_Club_Info || !group.Design_Club_Info.jgid){
                            if ($scope.hdinfo.ext_catgory == 11){
                                alert('请选择需要分账的机构');
                                return false;
                            }else{
                                group.Percent_Design_Club = 0;
                                currDesignClub = 0;
                            }
                        }
                    }
                    total = currPlatform + currClub + currLeader + currWinner + currSharer + currOrganizer
                    + currDesignClub + currZone;
                    if (total != 100 && group.ticketPair != 1) {
                        alert('分配比例的总和不等于100%！');
                        return false;
                    }
                }
            }

            return true;

        };
        //取消
        $scope.ConfirmCancel = function () {
            window.location.reload();
        };
        //分组检查
        $scope.ConfirmGroup = function (group) {
            if (group.ticketName.length < 3) {
                alert('分组名称必须大于3个字符！');
                return false;
            }
            if (null == group.ticketTime) {
                alert('请输入局时！');
                return false;
            }
            if (parseInt(group.ticketTime) < 1) {
                alert('局时必须大于等于1！');
                return false;
            }
            if (null == group.ticketAdd) {
                alert('请输入加秒！');
                return false;
            }
            if (parseInt(group.ticketAdd) < 0) {
                alert('加秒必须大于等于0！');
                return false;
            }
            if (null == group.ticketPrice || group.ticketPrice.length == 0) {
                group.ticketPrice = 0;
            }
            if (!group.ticketRound) {
                alert('轮次不能为空！');
                return false;
            }
            console.log(group.ticketEloMin>group.ticketEloMax)
            if (group.ticketEloMin != -1 &&
                group.ticketEloMax != -1 &&
                group.ticketEloMin * 1 > group.ticketEloMax * 1
            ) {
                
                alert('最小等级分不能大于最大等级分！');
                return false;
            }
            if (group.ticketAgeMin != -1 &&
                group.ticketAgeMax != -1 &&
                group.ticketAgeMin > group.ticketAgeMax
            ) {
                alert('最小年龄不能大于最大年龄！');
                return false;
            }
            //如果是线下认证赛，则检查最大认证等级不能超过11级
            if ($scope.hdinfo.ext_catgory == 11 && $scope.jgid != 1016 && $scope.jglevel != 11
                && (group.ticketLevelMax >= 5 || group.ticketLevelMax == -1)){
                alert('认证等级必须小于十一级棋士！');
                return false;
            }
            if (group.ticketLevelMin != -1 &&
                group.ticketLevelMax != -1 &&
                group.ticketLevelMin > group.ticketLevelMax
            ) {
                alert('最小认证等级不能大于最大认证等级！');
                return false;
            }
            if (group.ticketPair == 1 && group.ticketRound.length != 3) {
                alert('Q赛的轮次只能设置3轮！');
                return false;
            }
            if (group.ticketRound.length < 1) {
                alert('轮次设置最少1轮！');
                return false;
            }
            var reg = /^(-)?\d+(\.\d+)?$/;
            if (!reg.test(group.ticketPrice)) {
                alert("报名费输入有效数字！");
                return false;
            }
            if (!group.showfixplan) {
                var amount = 0;
                for (var i in group.planlist) {
                    amount += parseInt(group.planlist[i].Amount);
                    if (!group.planlist[i].BonusID){
                        alert("请选择奖励类型！");
                        return false;
                    }
                }
                if (amount > 100) {
                    alert('奖金池占比之和不得超过100');
                    return false;
                }
            }
            var ret = $scope.CheckValidDivide(group, true);
            if (false == ret) return ret;
            if ($scope.hdinfo.ext_type == 1 || $scope.hdinfo.ext_type == 2) {
                if(!group.ticketSignCount || parseInt(group.ticketSignCount) == 0){
                    alert('请输入报名人数！');
                    return false;
                }
            }
            group.showdetail = 0;
            return true;
        };
        $scope.changeHit = function (lable) {
            $scope.hitshow = !$scope.hitshow;
            if ($scope.hitshow) {
                $(`#${lable}`).show();
            } else {
                $(`#${lable}`).hide();
            }
        };
        //增加轮次
        $scope.AddRound = function (item) {
            var Roundflag = AddRound(item)
            return Roundflag;
        };
        //删除轮次
        $scope.DelRound = function (group, round) {
            for (i in group.ticketRound) {
                if (dayjs(group.ticketRound[i]).valueOf() == dayjs(round).valueOf()) {
                    group.ticketRound.splice(i, 1);
                    break;
                }
            }
        };
        //选择年龄限制
        $scope.ChooseBirth = function (group) {
            $scope.currGroup = group;
            if ($scope.currGroup.ticketAgeMin == -1) {
                $('#birthbegin').val('');
            } else {
                $('#birthbegin').val($scope.currGroup.ticketAgeMin);
            }
            if ($scope.currGroup.ticketAgeMax == -1) {
                $('#birthend').val('');
            } else {
                $('#birthend').val($scope.currGroup.ticketAgeMax);
            }
            $('#birth_modal').modal();
        };
        $scope.SetBirth = function () {
            var birthst = $('#birthbegin').val();
            var birthend = $('#birthend').val();
            if (birthst.length > 0) {
                $scope.currGroup.ticketAgeMin = birthst;
            } else {
                $scope.currGroup.ticketAgeMin = -1;
            }
            if (birthend.length > 0) {
                $scope.currGroup.ticketAgeMax = birthend;
            } else {
                $scope.currGroup.ticketAgeMax = -1;
            }
        };
        //选择轮次时间
        $scope.ChooseRoundTime = function (group, round) {
            $scope.currGroup = group;
            for (i in group.ticketRound) {
                if (dayjs(group.ticketRound[i]).valueOf() == dayjs(round).valueOf()) {
                    $scope.currRoundIndex = i;
                    break;
                }
            }
            $('#roundtime').val($scope.currGroup.ticketRound[$scope.currRoundIndex]);
            $('#round_modal').modal();
        };
        //设置轮次时间
        $scope.SetRoundTime = function () {
            var roundtime = $('#roundtime').val();
            if (roundtime.length == 0) {
                alert('轮次时间不能为空！');
                return;
            }
            var oldtime = $scope.currGroup.ticketRound[$scope.currRoundIndex];
            $scope.currGroup.ticketRound[$scope.currRoundIndex] = roundtime;
            //检查后续轮次时间自动更新
            for(var i = parseInt($scope.currRoundIndex) + 1; i < $scope.currGroup.ticketRound.length;i++){
                var oldoffset = dayjs($scope.currGroup.ticketRound[i]).valueOf() - dayjs(oldtime).valueOf();
                oldtime = $scope.currGroup.ticketRound[i];
                $scope.currGroup.ticketRound[i] = GetOffsetDate(oldoffset, roundtime);
                roundtime = $scope.currGroup.ticketRound[i];
            }
        };
        //设置是否实名的逻辑
        $scope.SetNeedAuth = function (group, isauth) {
            if (isauth) {
                //                group.hideOther = false;
                group.ticketNeedauth = 1;
                //group.ticketEloEffect = 1; //by @lzj 取消实名与记录等级分联动
            } else {
                //                group.hideOther = true;
                group.ticketNeedauth = 0;
                //group.ticketEloEffect = 0; //by @lzj 取消实名与记录等级分联动
                //                group.ticketLimitSex = -1;
                //                group.ticketLevelMin = -1;
                //                group.ticketLevelMax = -1;
                //                group.ticketEloMin = -1;
                //                group.ticketEloMax = -1;
                //                group.ticketAgeMin = -1;
                //                group.ticketAgeMax = -1;
            }
        };
        $scope.ShowPlanOper = function (plan, planlist) {
            for (var i in planlist) {
                if (plan.id == planlist[i].id) {
                    if (i > 0 && i < planlist.length) {
                        return false;
                    }
                }
            }
            return true;
        };
        //初始化模板
        $scope.InitChooseDisPlan = function (group) {
            var displan = group.ticketDistribute;
            if (displan) {
                if (displan.id > 1) {
                    group.tempname = displan.title;
                    group.tempid = displan.id;
                    group.planlist = displan.description.planbonus;
                    group.showfixplan = (displan.description.Bonus_unit == '元');
                } else {
                    group.tempname = '';
                    group.tempid = null;
                    group.planlist = [{
                        'id': GenerateUUID(),
                        'name': '',
                        'Mode': '在线账户',
                        'Amount': '',
                        'PersonNum': '',
                        'BonusID' : '',
                    }];
                    group.showfixplan = false;
                }
                InitChooseBonusID(group.planlist);
            }

        };
        //检查输入的合法性
        $scope.CheckValidPlan = function (plan, type) {
            var amount = 0;
            switch (type) {
                case 1: //奖金占比
                    amount = parseInt(plan.Amount);
                    if (amount < 0 || amount > 100) {
                        alert('请输入0~100之间的数字！');
                        plan.Amount = 1;
                    }
                    break;
                case 2: //奖金金额
                    amount = parseInt(plan.Amount);
                    if (amount < 0 || amount > 50000) {
                        alert('请输入0~50000之间的数字！');
                        plan.Amount = 1;
                    }
                    break;
                case 3: //奖励人数
                    var person = parseInt(plan.PersonNum);
                    if (person < 1) {
                        alert('请输入大于0的数字！');
                        plan.PersonNum = 1;
                    }
                    break;
                case 4: //轮次数
                    var round_limit = parseInt(plan.round_limit);
                    if (round_limit < 1) {
                        alert('请输入大于0的数字！');
                        plan.round_limit = 1;
                    }
                    break;
            }
        };
        //删除模板
        $scope.DelPlanTemp = function (group) {
            if (group.ticketDistribute.createby > 0) {
                if (!confirm('确认删除？')) {
                    return;
                }
                var postData = {
                    'id': group.ticketDistribute.id
                };
                AddLoadShow($scope);
                $http.post(rootpath + '/RestCore/DelDisPlanTemp?token=dummy', postData)
                    .success(function (ret) {
                        ReduceLoadShow($scope);
                        if (ret.resp.err == 0) {
                            for (i in $scope.distributeTempList) {
                                if ($scope.distributeTempList[i].id == postData.id) {
                                    $scope.distributeTempList.splice(i, 1);
                                    break;
                                }
                            }
                            group.ticketDistribute = $scope.distributeTempList[0];
                        } else {
                            alert(ret.resp.msg);
                        }
                    })
                    .error(function () {
                        $scope.errmsg = '网络出问题了，请刷新重试！';
                        ReduceLoadShow($scope);
                    });
            }
        };
        $scope.ClickBonus = function (group) {
            switch (parseInt(group.ticketBonus)) {
                case 1:
                    group.ticketBonus = 2;
                    break;
                case 2:
                    group.ticketBonus = 1;
                    break;
            }
        }
        $scope.SetDisplan = function (group) {
            group.ticketBonus = 1;
            if (!group.planlist) {
                group.planlist = [{
                    'id': GenerateUUID(),
                    'name': '',
                    'Mode': '在线账户',
                    'Amount': '',
                    'PersonNum': '',
                    'BonusID' : '',
                }];
                InitChooseBonusID(group.planlist);
            }
            if (!group.ticketDistribute) {
                group.ticketDistribute = $scope.distributeTempList[0];
            } else {
                if (group.ticketPair == 1) {
                    if(group.ticketPrice == 20){
                        group.ticketDistribute = $scope.QPLAN_DEFAULT20[0];
                    }else if(group.ticketPrice == 10){
                        group.ticketDistribute = $scope.QPLAN_DEFAULT10[0];
                    }else{
                        group.ticketDistribute = $scope.QPLAN_DEFAULT[0];
                    }

                } else {
                    var findDis = false;
                    for (i in $scope.distributeTempList) {
                        if (group.ticketDistribute === $scope.distributeTempList[i]) {
                            findDis = true;
                            break;
                        }
                    }
                    if (!findDis) {
                        group.ticketDistribute = $scope.distributeTempList[0];
                    }
                }

            }
        };
        //保存分配模板
        $scope.SavePlanTemp = function (group, saveas) {
            if (!group.tempname || group.tempname.length < 3) {
                alert('模板名称不能小于3个字符！');
                return;
            }
            var displan = {
                'title': group.tempname,
                'description': {
                    'Bonus_floor': 0,
                    'Bonus_top': 50000,
                    'Percent_Club': DEFAULT_CLUB,
                    'Percent_Leader': DEFAULT_LEADER,
                    'Percent_PlatForm': DEFAULT_PLATFORM,
                    'Percent_Winner': DEFAULT_WINNER,
                    'Percent_Share' : DEFAULT_SHARER,
                    'Percent_Organizer' : DEFAULT_ORGANIZER,
                    'Percent_Zone' : DEFAULT_RATEZONE,
                    'planbonus': [],
                },
            };
            if (!saveas) {
                displan.id = group.tempid;
            }
            var amount = 0;
            for (var i in group.planlist) {
                var plan = group.planlist[i];
                if (!plan.PersonNum) {
                    alert('请输入奖励人数！');
                    return;
                }
                if (!plan.BonusID) {
                    alert('请选择奖励类型！');
                    return;
                }
                displan.description.planbonus.push(plan);
                if (group.showfixplan) {
                    //固定奖金
                    if (!plan.Amount) {
                        alert('请输入奖金金额！');
                        return;
                    }
                    displan.description.Bonus_unit = '元';
                } else {
                    //奖金池
                    if (!plan.Amount) {
                        alert('请输入奖金池占比！');
                        return;
                    }
                    displan.description.Bonus_unit = '%';
                    amount += parseInt(plan.Amount);
                }
            }
            if (!group.showfixplan) {
                if (amount > 100) {
                    alert('奖金池占比之和不得超过100！');
                    return;
                }
            }
            AddLoadShow($scope);
            $http.post(rootpath + '/RestCore/AddOrUpdateDisPlanTemp?token=dummy', displan)
                .success(function (ret) {
                    ReduceLoadShow($scope);
                    if (ret.resp.err == 0) {

                        group.ticketDistribute = ret.content;
                        group.tempid = ret.content.id;
                        var finddis = false;
                        for (i in $scope.distributeTempList) {
                            if (group.ticketDistribute.id == $scope.distributeTempList[i].id) {
                                finddis = true;
                                $scope.distributeTempList[i] = group.ticketDistribute;
                                break;
                            }
                        }
                        if (!finddis)
                            $scope.distributeTempList.push(group.ticketDistribute);

                    } else {
                        alert(ret.resp.msg);
                    }
                })
                .error(function () {
                    $scope.errmsg = '网络出问题了，请刷新重试！';
                    ReduceLoadShow($scope);
                });
        };
        //增加分配项
        $scope.AddPlan = function (planlist) {
            if (planlist.length == 99) {
                return;
            }
            var insert_index = planlist.length;
            for (var i in planlist) {
                if (planlist[i].name.length == 0) {
                    alert('请输入奖励等级！');
                    return;
                }
                if (planlist[i].Amount == '') {
                    alert('请输入占比或金额！');
                    return;
                }
                if (planlist[i].PersonNum == '') {
                    alert('请输入奖励人数！');
                    return;
                }
                if (planlist[i].BonusID == '') {
                    alert('请选择奖励类型！');
                    return;
                }
                if (planlist[i].BonusID == 'Bonus_99') {
                    if (i != insert_index - 1){
                        alert('分配方案错误，请联系开发人员！');
                        return;
                    }
                    insert_index--;
                }
            }
            var plan = {
                'id': GenerateUUID(),
                'name': '',
                'Mode': '在线账户',
                'Amount': '',
                'PersonNum': '',
                'BonusID' : '',
            };
            planlist.splice(insert_index, 0, plan);
            InitChooseBonusID(planlist);
        };
        //删除分配项
        $scope.DelPlan = function (planlist, plan) {
            for (var i in planlist) {
                var item = planlist[i];
                if (item.id == plan.id) {
                    planlist.splice(i, 1);
                    break;
                }
            }
            InitChooseBonusID(planlist);
        };
        //增加分组
        $scope.AddGroup = function () {
            var lastindex = $scope.costLists.length;
            if (lastindex > 0) {
                if (!$scope.ConfirmGroup($scope.costLists[lastindex - 1])) {
                    return;
                }
            }

            var group = {
                "ticketName": "【第" + (lastindex + 1) + "组】",
                "ticketPrice": 0,
                "ticketNum": 0,
                'ticketLimitSex': -1,
                'ticketLevelMin': -1,
                'ticketLevelMax': -1,
                'ticketEloMin': -1,
                'ticketEloMax': -1,
                'ticketAgeMin': -1,
                'ticketAgeMax': -1,
                'ticketNeedauth': needauth,
                'ticketEloEffect': 1,
                'ticketTime': DEFAULT_TICKETTIME,
                'ticketAdd': DEFAULT_TICKETADD,
                'sign_start_time': DEFAULT_SIGNSTARTTIME,
                'sign_end_time': DEFAULT_SIGNENDTIME,
                'ticketType': 0,
                'ticketPair': DEFAULT_PAIRTYPE,
                'showdetail': 1,
                'ticketBonus': 0,
                'ticketSignCount': 4,
                'ticketSignWait': 0,
                'leader_limit' : '',
                manualdelay : 5,
                'planlist': [{
                    'id': GenerateUUID(),
                    'name': '',
                    'Mode': '在线账户',
                    'Amount': '',
                    'PersonNum': '',
                    'BonusID' : '',
                }],
                'Percent_PlatForm': DEFAULT_PLATFORM,
                'Percent_Leader': DEFAULT_LEADER,
                'Percent_Club': DEFAULT_CLUB,
                'Percent_Winner': DEFAULT_WINNER,
                'Percent_Share' : DEFAULT_SHARER,
                'Percent_Organizer' : DEFAULT_ORGANIZER,
                'Percent_Zone' : DEFAULT_RATEZONE,
                'Percent_Design_Club' : DEFAULT_DESIGN_CLUB,
                'Design_Club_Info' : {jgid:0, name:'点击选择机构'},
                // 'vipflag': VIP1_BIT | VIP2_BIT,
                'vipflag': 0,
            };
            initTicketLevel(group);
            group.show_auto_promp = true;
            group.roundjusttime = 1;
            group.ticketDistribute = $scope.distributeTempList[0];
            InitChooseBonusID(group.planlist);
            $scope.costLists.push(group);
            //添加比赛分组默认轮次 @lzj
            AddRound(group)
        };
        $scope.ClickOper = function (group) {
            $scope.delGroup = group;
            $('#del_modal1').modal();

        };
        // // 删除分组
        $scope.DelGroup = function () {
            for (i in $scope.costLists) {
                if ($scope.costLists[i] == $scope.delGroup) {
                    $scope.costLists.splice(i, 1);
                    break;
                }
            }
        };

        $scope.CheckInt = function (input) {
            return StrReplaceForFloat(input);
        };
        //提交分组信息
        $scope.SubmitGroups = function (ispublish) {
            $scope.errmsg = '';
            if (ispublish) {
                $scope.groups.state = 1;
            }
            if(iscopy){
                $scope.groups.iscopy = 1;
            }
            //对首轮编排规则进行设置提交
            if ($scope.groups.costdetail){
                for (var onegroup of $scope.groups.costdetail){
                    onegroup.pair_sort = null;
                    if (onegroup.pair_sort_name){
                        onegroup.pair_sort = '["name","elo","uid"]';
                    }
                }
            }
            AddLoadShow($scope);
            $http.post(rootpath + '/RestCore/AddOrUpdateGroups?token=dummy', $scope.groups)
                .success(function (ret) {
                    ReduceLoadShow($scope);
                    switch (ret.resp.err) {
                        case 0:
                            if (ispublish) {
                                GetActGroupsThird();
                                $('.ewm').show();
                                $('#code').html('');
                                var thisuRL = window.location.origin +
                                    '/index.php/WxViews/actindex?id=' + hdid;
                                $('#code').qrcode(thisuRL);
                                $("#code canvas").css("width", 190);
                                $('.inputvalue').val(thisuRL);
                            } else {
                                window.location.href = 'addActivity?token=dummy&hdid=' + hdid + copyparams;
                            }
                            break;
                        case -121: //
                            if (confirm(ret.resp.msg)) {
                                $scope.groups.confirmsave = true;
                                $scope.SubmitGroups(ispublish);
                            }
                            break;
                        case -124: //删除分组提示
                            if(confirm(ret.resp.msg)){
                                $scope.groups.delmergegroup = true;
                                $scope.SubmitGroups(ispublish);
                            }
                            break;
                        default:
                            $scope.errmsg = ret.resp.msg;
                            break;
                    }
                })
                .error(function () {
                    $scope.errmsg = '网络出问题了，请刷新重试！';
                    ReduceLoadShow($scope);
                });
        };
        // 活动发布成功后--复制链接
        $scope.copyLink = function () {
            var Url1 = document.getElementById("Copy");
            console.log(Url1.value);
            Url1.select(); //选择对象  
            var tag = document.execCommand("Copy"); //执行浏览器复制命令  
            if (tag) {
                $('.copyok').show();
                $interval(function () {
                    $('.copyok').hide();
                }, 1500);
            }
        };
        // 活动发布成功后--预览 lxq 2019-1-8
        $scope.previewPage = function (evt) {
            window.open(rootpath + '/WxViews/actindex?id=' + hdid);
        }
        // 活动发布成功后--关闭 lxq 2019-1-8
        $scope.linkList = function (evt) {
            window.location.href = 'activityList?token=dummy';
        }
        //添加报名人--报名管理 lxq 2019-1-8
        $scope.addPersonnel = function (evt) {
            window.location.href = rootpath + '/YbActivity/enlistsInfo?token=dummy&id=' + hdid;
        }
        //点击灰色区域--跳转到活动列表
        $scope.backActList = function ($event) {
            window.location.href = 'activityList?token=dummy';
        }
        //阻止子元素--继承父元素的点击事件
        $scope.stop = function ($event) {
            $event.stopPropagation();
        };

        $scope.ChangeBonusID = function (plan) {
          console.log("ChangeBonusID", plan);
          plan.showRoundLimit = false;
          plan.PersonNum = "";
          plan.round_limit = "";
          if (plan.BonusID == "Bonus_99"){
              plan.showRoundLimit = true;
              plan.PersonNum = -1;
          }
        };
        //切换编排类型
        $scope.ChangePair = function (group) {
            if (group.ticketPrice == '') {
                group.ticketPrice = 0;
            }
            if (group.ticketPair == 1) {
                if ($scope.hdinfo.ext_type == 1) {
                    group.ticketPair = $scope.comppairs[0].id;
                    alert('团体对抗赛不允许选择Q赛！');
                    return;
                }
                if(group.ticketPrice == 20){
                    group.ticketDistribute = $scope.QPLAN_DEFAULT20[0];
                }else if(group.ticketPrice == 10){
                    group.ticketDistribute = $scope.QPLAN_DEFAULT10[0];
                }else{
                    group.ticketDistribute = $scope.QPLAN_DEFAULT[0];
                }
                if ($scope.hdinfo.ext_catgory == 2) {
                    group.Percent_PlatForm = 0;
                    group.Percent_Club = 0;
                    group.Percent_Leader = 30;
                    group.Percent_Winner = 70;
                } else {
                    var plan = group.ticketDistribute.description;
                    group.Percent_PlatForm = plan.Percent_PlatForm;
                    group.Percent_Leader = plan.Percent_Leader;
                    group.Percent_Club = plan.Percent_Club;
                    group.Percent_Winner = plan.Percent_Winner;
                }
            } else {
                group.Percent_PlatForm = DEFAULT_PLATFORM;
                group.Percent_Leader = DEFAULT_LEADER;
                group.Percent_Club = DEFAULT_CLUB;
                group.Percent_Winner = DEFAULT_WINNER;
                group.Percent_Share  = DEFAULT_SHARER;
                group.ticketDistribute = $scope.distributeTempList[0];
            }
            group.show_loop_promp = false;
            group.show_auto_promp = false;
            switch (group.ticketPair) {
                case 2:
                case 3:
                    group.show_loop_promp = true;
                    break;
                case 4:
                    group.show_auto_promp = true;
                    break;
            }
        };
        $scope.ChangeQPairPrice = function(group){
            group.showChooseBonus = true;
            if(group.ticketPrice){
                group.showChooseBonus = false;
                $scope.SetDisplan(group);
                $scope.ChangePair(group);
            }else{
                group.ticketBonus = 0;
            }
        };
        $scope.clickVipFlag = function (group, bit){
              if (group.vipflag&bit){
                  group.vipflag &= ~bit;
              }else{
                  group.vipflag |= bit;
              }
              //固定奖金
              if (bit === VIP2_BIT){
                  group.Percent_PlatForm = 80;
                  group.Percent_Club = 0;
                  group.Percent_Leader = 0;
                  group.Percent_Winner = 20;
                  group.Percent_Share = 0;
                  group.Percent_Organizer = 0;
                  group.Percent_Zone = 0;
              }
        };
        $scope.ShowChooseSponsor = function(clubinfo){
            $scope.currSponsor = clubinfo;
            $('#addLabel_modal').modal('show');
            $scope.userSubmitBtn = true;
            GetSponsorList();
        };
        $scope.SetSponsor = function(){
            $scope.userSubmitBtn = false;
            $('#addLabel_modal').modal('hide');
        };

        $scope.ClickChooseSponsor = function(jgid, title){
            $scope.currSponsor.name = title;
            $scope.currSponsor.jgid = jgid;
            $scope.sponsorTable.api().draw();
        };

        /*
         * functions start
         * */


        function AddRound(item) {
            if (!item.ticketTime) {
                alert('请输入局时！');
                return false;
            }
            var ticketTime = parseInt(item.ticketTime);
            if (item.ticketTime < 1) {
                alert('局时必须大于等于1！');
                return false;
            }
            if (null == item.ticketAdd) {
                alert('请输入加秒！');
                return false;
            }
            var ticketAdd = parseInt(item.ticketAdd);
            if (item.ticketAdd < 0) {
                alert('加秒必须大于等于0！');
                return false;
            }
            if (!item.ticketRound || item.ticketRound.length == 0) {
                var endTime = dayjs($scope.hdinfo.sign_endtime).valueOf();
                var actstart = dayjs($scope.hdinfo.act_starttime).valueOf();
                if (endTime < actstart) {
                    endTime = actstart;
                }
                item.ticketRound = [];
                item.ticketRound.push(getCurrDate(endTime));
            } else {
                var offset = ticketTime * 60 * 2 + ticketAdd * 100 + 5 * 60;
                var index = item.ticketRound.length;

                var lastTime = item.ticketRound[index - 1];
                var endTime = dayjs(lastTime).valueOf();
                endTime += offset * 1000;
                item.ticketRound.push(getCurrDate(endTime));
            }
            return true;
        }
        //lxq 2019-01-08
        function GetActGroupsThird() {
            $http.post(rootpath + '/RestCore/GetActGroups?token=dummy&hdid=' + hdid)
                .success(function (ret) {
                    $('#successTitle').html(ret.content.title);
                    $('#successStarttime').html(ret.content.act_starttime);
                    $('#successEndtime').html(ret.content.act_endtime);
                })
                .error(function () {
                    $scope.successText = '您的网络好像有点问题';
                });
        }

        function GetActGroups() {
            AddLoadShow($scope);
            $http.post(rootpath + '/RestCore/GetActGroups?token=dummy&hdid=' + hdid)
                .success(function (ret) {
                    ReduceLoadShow($scope);
                    if (ret.resp.err == 0) {
                        $scope.groups = {
                            'hdid': hdid,
                        };
                        $scope.hdinfo = ret.content;

                        var ext_catgory = parseInt($scope.hdinfo.ext_catgory);
                        switch (ext_catgory){
                            case 2:
                                DEFAULT_PLATFORM = 0;
                                DEFAULT_CLUB = 0;
                                DEFAULT_LEADER = 70;
                                DEFAULT_WINNER = 30;
                                break;
                            case 6:
                                DEFAULT_TICKETTIME = 25;
                                DEFAULT_TICKETADD = 5;
                                break;
                            case 11:
                            case 10:
                                needauth = 1;
                                DEFAULT_PLATFORM = 10;
                                DEFAULT_CLUB = 30;
                                DEFAULT_LEADER = 30;
                                DEFAULT_WINNER = 0;
                                DEFAULT_ORGANIZER = 30;
                                // DEFAULT_PAIRTYPE = 0;
                                break;
                        }
                        $scope.groups.costdetail = ret.content.costdetail;
                        if (!$scope.groups.costdetail) {
                            var group = {
                                "ticketName": "【第1组】",
                                "ticketPrice": 0,
                                "ticketNum": 0,
                                'ticketLimitSex': -1,
                                'ticketLevelMin': -1,
                                'ticketLevelMax': -1,
                                'ticketEloMin': -1,
                                'ticketEloMax': -1,
                                'ticketAgeMin': -1,
                                'ticketAgeMax': -1,
                                'ticketNeedauth': needauth,
                                'ticketEloEffect': 1,
                                'ticketTime': DEFAULT_TICKETTIME,
                                'ticketAdd': DEFAULT_TICKETADD,
                                'sign_start_time': DEFAULT_SIGNSTARTTIME,
                                'sign_end_time': DEFAULT_SIGNENDTIME,
                                'ticketType': 0,
                                'ticketPair': DEFAULT_PAIRTYPE,
                                'showdetail': 1,
                                'ticketBonus': 0,
                                'ticketSignCount': 4,
                                'leader_limit' : '',
                                manualdelay : 5,
                                'ticketSignWait': 0,
                                'planlist': [{
                                    'id': GenerateUUID(),
                                    'name': '',
                                    'Mode': '在线账户',
                                    'Amount': '',
                                    'PersonNum': '',
                                    'BonusID' : '',
                                }],
                                'Percent_PlatForm': DEFAULT_PLATFORM,
                                'Percent_Leader': DEFAULT_LEADER,
                                'Percent_Club': DEFAULT_CLUB,
                                'Percent_Winner': DEFAULT_WINNER,
                                'Percent_Share' : DEFAULT_SHARER,
                                'Percent_Organizer' : DEFAULT_ORGANIZER,
                                'Percent_Zone' : DEFAULT_RATEZONE,
                                'Percent_Design_Club' : DEFAULT_DESIGN_CLUB,
                                'Design_Club_Info' : {jgid:0, name:'点击选择机构'},
                                // 'vipflag': VIP1_BIT | VIP2_BIT,
                                'vipflag': 0,

                            };
                            initTicketLevel(group);
                            InitChooseBonusID(group.planlist);
                            group.show_auto_promp = true;
                            group.roundjusttime = 1;
                            $scope.group = group;
                            group.ticketDistribute = $scope.distributeTempList[0];
                            $scope.groups.costdetail = [];
                            $scope.groups.costdetail.push(group);
                        }
                        $scope.costLists = $scope.groups.costdetail;
                        if($scope.costLists){
                            for(var i in $scope.costLists){
                                InitChooseBonusID($scope.costLists[i].planlist);
                                $scope.costLists[i].showChooseBonus = true;
                                if(typeof $scope.costLists[i].ticketPrice == 'undefined'
                                        ||$scope.costLists[i].ticketPrice == null
                                || $scope.costLists[i].ticketPrice == ''){
                                    $scope.costLists[i].ticketPrice = 0;
                                }
                                if(parseInt($scope.costLists[i].ticketBonus) && parseInt($scope.costLists[i].ticketPair) == 1){
                                    if($scope.costLists[i].ticketPrice == 20){
                                        $scope.costLists[i].ticketDistribute = $scope.QPLAN_DEFAULT20[0];
                                    }else if($scope.costLists[i].ticketPrice == 10){
                                        $scope.costLists[i].ticketDistribute = $scope.QPLAN_DEFAULT10[0];
                                    }else{
                                        $scope.costLists[i].ticketDistribute = $scope.QPLAN_DEFAULT[0];
                                    }
                                }
                                if (!$scope.costLists[i].Percent_Zone){
                                    $scope.costLists[i].Percent_Zone = DEFAULT_RATEZONE;
                                }
                            }
                        }
                        //当轮次为空时默认增加一轮 @lzj
                        if ($scope.group && !$scope.group.ticketRound) {
                            AddRound($scope.group)
                        }
                        if ($scope.jgid != 1016 && $scope.jgid != $scope.hdinfo.shopid
                        && $scope.jgid != $scope.hdinfo.sponsor_id){
                            $scope.showdistribution = false;
                        }
                    }
                })
                .error(function () {
                    ReduceLoadShow($scope);
                });
        }

        function GetDistributeTempList() {
            AddLoadShow($scope);
            $http.post(rootpath + '/RestGxService/GetDefaultFundDistribute?token=dummy', {
                    'token': $('#tokenupdate').val(),
                })
                .success(function (ret) {
                    ReduceLoadShow($scope);
                    if (ret.resp.err == 0) {
                        $scope.distributeTempList = ret.content;
                        GetActGroups();
                    }
                })
                .error(function () {
                    ReduceLoadShow($scope);
                });
        }

        function GetDistributeRateRule() {
            AddLoadShow($scope);
            $http.get(rootpath + '/RestCore/GetDistributeRateRule?token=dummy')
                .success(function (ret) {
                    ReduceLoadShow($scope);
                    if (ret.resp.err == 0) {
                        $scope.raterule = ret.content;
                    }
                })
                .error(function () {
                    ReduceLoadShow($scope);
                });
        }
        function GetDistributeBonusID() {
            AddLoadShow($scope);
            $http.get(rootpath + '/RestCore/GetDistributeBonusID?token=dummy')
                .success(function (ret) {
                    ReduceLoadShow($scope);
                    if (ret.resp.err == 0) {
                        $scope.bonuslist = ret.content;
                    }
                })
                .error(function () {
                    ReduceLoadShow($scope);
                });
        }
        function IsMatchDirector() {
            AddLoadShow($scope);
            $http.get(rootpath + '/RestCore/IsMatchDirector?token=dummy&jgid=' + $scope.jgid)
                    .success(function (ret) {
                        ReduceLoadShow($scope);
                        if (ret.resp.err == 0) {
                            $scope.isMatchDirector = ret.content;
                        }
                    })
                    .error(function () {
                        ReduceLoadShow($scope);
                    });
        }
        function InitChooseBonusID(planlist){
            if ($scope.bonuslist && planlist && planlist.length > 0){
                for (var i in planlist){
                    var plan = planlist[i];
                    plan.ChooseBonusList = [];
                    if (!plan.BonusID || plan.BonusID != 'Bonus_99'){
                        plan.BonusID = $scope.bonuslist[i].id;
                    }
                    plan.ChooseBonusList.push($scope.bonuslist[i]);
                    if ((i == planlist.length - 1)){
                        plan.ChooseBonusList.push($scope.bonuslist[$scope.bonuslist.length-1]);
                    }
                }
            }
        }
        function GetSponsorList(){
            var postUrl = rootpath + '/RestCore/GetSponsorList?token=dummy';
            if($scope.sponsorTable){
                var oSettings = $scope.sponsorTable.fnSettings();
                oSettings.ajax = postUrl;
                $scope.sponsorTable.api().draw();
            }else{
                $scope.sponsorTable = $('#sponsorlist_table').dataTable({
                    "processing": true,
                    "aoColumnDefs": [{"bSortable": false, "aTargets": [0]}], //设置不可排序列
                    "serverSide": true,
                    // "bStateSave": true,
                    "deferRender": true,
                    "orderClasses": true,
                    "bProcessing": true,
                    "ajax": postUrl,
                    "columns": [
                        {"data": "jgid"},
                        {"data": "title"},
                        {"data": "name"},
                        {"data": "add_time"},
                    ],
                    "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                        var checked = ''
                        if(aData.jgid == $scope.currSponsor.jgid){
                            checked = 'checked';
                        }
                        $('td:eq(0)', nRow).html($compile('<input type="radio" ' + checked +
                            '  ng-click="ClickChooseSponsor(' + aData.jgid + ', \'' + aData.title +'\')"' +
                            ' ><span>' + aData.jgid + '</span>'
                        )($scope));
                        return nRow;
                    }

                });
            }
        }
        //如果是普通机构建立的线下认证赛，则初始化等级限制为无等级~12级棋士
        function initTicketLevel(groupinfo) {
            if ($scope.hdinfo.ext_catgory == 11 && $scope.jgid != 1016 && $scope.jglevel != 11){
                groupinfo.ticketLevelMin = 0;
                groupinfo.ticketLevelMax = 4;
            }
        }

    });

    app.filter('filterCompType', function () {
        return function (input, obj) {
            for (i in obj) {
                if (input == obj[i].id) {
                    return obj[i].name;
                }
            }
            return obj[0].name;
        };
    });
    app.filter('filterFormatDate', function () {
        return function (input) {
            if(input == -1) return input;
            var year = input.substr(0, 4);
            var month = input.substr(4, 2);
            var day = input.substr(6, 2);
            return year + '/' + month + '/' + day;
        };
    });
</script>

</html>